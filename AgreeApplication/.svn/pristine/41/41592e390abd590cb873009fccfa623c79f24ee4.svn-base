package com.nspl.app.web.rest;

import com.codahale.metrics.annotation.Timed;

import java.io.InputStream;

import com.mysql.jdbc.Blob;
import com.nspl.app.domain.FileTemplateLines;
import com.nspl.app.domain.FileTemplates;
import com.nspl.app.domain.LookUpCode;
import com.nspl.app.domain.RuleGroup;
import com.nspl.app.domain.RuleGroupDetails;
import com.nspl.app.domain.Rules;
import com.nspl.app.domain.SourceProfileFileAssignments;
import com.nspl.app.domain.SourceProfiles;
import com.nspl.app.repository.FileTemplateLinesRepository;
import com.nspl.app.repository.FileTemplatesRepository;
import com.nspl.app.repository.LookUpCodeRepository;
import com.nspl.app.repository.RuleGroupDetailsRepository;
import com.nspl.app.repository.RuleGroupRepository;
import com.nspl.app.repository.RulesRepository;
import com.nspl.app.repository.SourceProfileFileAssignmentsRepository;
import com.nspl.app.repository.SourceProfilesRepository;
import com.nspl.app.repository.search.FileTemplatesSearchRepository;
import com.nspl.app.service.FindDelimiterAndFileExtensionService;
import com.nspl.app.web.rest.dto.ErrorReport;
import com.nspl.app.web.rest.dto.FileTempDTO;
import com.nspl.app.web.rest.dto.FileTemplateDTO;
import com.nspl.app.web.rest.dto.FileTemplateDataDTO;
import com.nspl.app.web.rest.dto.FileTemplateLinesDTO;
import com.nspl.app.web.rest.dto.FileTemplatesPostingDTO;
import com.nspl.app.web.rest.dto.FileTmpDTO;
import com.nspl.app.web.rest.dto.SampleDataDTO;
import com.nspl.app.web.rest.dto.SourceProfileFileAssignmentDTO;
import com.nspl.app.web.rest.dto.StatusStringDTO;
import com.nspl.app.web.rest.util.HeaderUtil;
import com.nspl.app.web.rest.util.PaginationUtil;

import io.swagger.annotations.ApiParam;
import io.github.jhipster.web.util.ResponseUtil;

import org.json.JSONException;
import org.json.JSONObject;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Required;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.UnsupportedEncodingException;
import java.net.URI;
import java.net.URISyntaxException;
import java.time.LocalDate;
import java.time.ZonedDateTime;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Optional;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.inject.Inject;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;
import javax.persistence.TypedQuery;

import static org.elasticsearch.index.query.QueryBuilders.*;


/**
 * REST controller for managing FileTemplates.
 */
@RestController
@RequestMapping("/api")

public class FileTemplatesResource {

	private final Logger log = LoggerFactory.getLogger(FileTemplatesResource.class);

	private static final String ENTITY_NAME = "fileTemplates";

	private final FileTemplatesRepository fileTemplatesRepository;

	private final FileTemplatesSearchRepository fileTemplatesSearchRepository;



	private final SourceProfileFileAssignmentsRepository sourceProfileFileAssignmentsRepository;


	private final SourceProfilesRepository sourceProfilesRepository;

	//  private final UserService userService;

	//@Inject
	private final FileTemplateLinesRepository fileTemplateLinesRepository;

	//	@Inject
	private final FindDelimiterAndFileExtensionService findDelimiterAndFileExtensionService;


	@Inject
	RuleGroupRepository ruleGroupRepository;


	@Inject
	RuleGroupDetailsRepository ruleGroupDetailsRepository;

	@Inject
	RulesRepository rulesRepository;

	/*  @Inject
    UserService userService;*/

	@Inject
	LookUpCodeRepository lookUpCodeRepository;
	@PersistenceContext(unitName="default")
	private EntityManager em;



	//declaration for img paths
	private String chaseImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAk1BMVEX///8AXLnw8PEAWLcYZrQAYMIAXr1ahbFOfaxKi818q9vt7u5bibhLfrEXaLoib73Y29/29vcsdsDR194accne4eS4w89ChMcNacXn6es5drjBzdoXbMJmndUAZcuktMVljLSctMw2fMOSrMd6nL9xn81UldYfbr0JZ8RJf7aYveOFnrxnlME/fbwKYLamwNuFs+KsN3Y0AAABXElEQVRIie3W23KCMBAG4ATctB4QAyIirQdapUht+/5P14gKG7JBOtObzvS/5f8gM4ENjLUjjyOco1HAGUvGSnC1TKS9H50SxibAtYBnFUnw4ZiAQ2ER4wwGFOAQO1TfyUDQgEOWmH0ZA7cBSshC9ayAQxAR/Q7AwZ9p4NLqABzy0Oh3Ai7mjXi/djqBEmmrfwPClrdF1d/Xt6zAdjqwJj8/o2yWUAHp2DNW1z9droN7Gf0+KAuvzmTWA3hraHLoAR7QxrjDf/BXwZeLvpA+IFpNm6x6ADUiUYi+Ce5FA88/A7BSa4geO7KVGEBQjdgN/kBaecIA/OuAXSwFpyN8BERej9fUJjDAo5Klc1ogoPUZC2nRALFMmZYwp0QNbmMVZeYTU7sGZl/tR2CKG1hvqB0lxBXAjn4HkqwtLmD9QvfVexsDAbxXW18d7if9x8Q9g9DeV6fJfohzSI3GNxONHJoVvN79AAAAAElFTkSuQmCC";

	private String bOAImg="data:image/png;base64,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";

	private String wellsforgoImg="http://www.montrosechamber.org/wp-content/sabai/File/files/664e01a80cd59928f6152513282a9f9c.png";

	private String citiImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAP1BMVEX///8AAJkzM8ymyvBmZsz/AACZmcwAAMzMzP//MzP/mZn/Zmb/zMwAM8z/fID/UFDx8fH/mczM7P/j4+Pq6urRYjM3AAAAuklEQVQ4jeWRSQKDIAxFMxFQtHa6/1mbQNUWtd23WTD9l08IAD8Zw9SFELp8OR/IrnaFGXb03s77ujKm3+inELLPwnVzaoGcSxKhFpM8HdRJyO1REiJxb0nAEpFEfbPogh6RIZo52QqRICG+6KRKKMWcdURRNiDO/rEWpfPtdVwBxfG9vBYQlG8AfQZ4LXcfsMeVO+QQUHu5eHsWgJTgugJgPbCgBOMzt2kUwI2l/CDrvWZ4Y3TzI/8cDzOPBHXjaCmjAAAAAElFTkSuQmCC";

	private String googleDriveImg="https://upload.wikimedia.org/wikipedia/commons/9/9b/Logo_of_Google_Drive.png";

	private String dropBoxImg="https://cfl.dropboxstatic.com/static/images/brand/twitter-card-glyph@2x-vflVqhKLO.png";

	private String sFTPImg="https://static1.squarespace.com/static/5410eb95e4b015076b7107ef/t/547e7ce3e4b08db18187a6cb/1417575651995/odrive-attachestoSFTP.png";




	public FileTemplatesResource(FileTemplatesRepository fileTemplatesRepository, FileTemplatesSearchRepository fileTemplatesSearchRepository,SourceProfileFileAssignmentsRepository sourceProfileFileAssignmentsRepository,SourceProfilesRepository sourceProfilesRepository,FileTemplateLinesRepository fileTemplateLinesRepository,FindDelimiterAndFileExtensionService findDelimiterAndFileExtensionService) {
		this.fileTemplatesRepository = fileTemplatesRepository;
		this.fileTemplatesSearchRepository = fileTemplatesSearchRepository;
		this.sourceProfileFileAssignmentsRepository=sourceProfileFileAssignmentsRepository;
		this.sourceProfilesRepository=sourceProfilesRepository;
		this.fileTemplateLinesRepository=fileTemplateLinesRepository;
		this.findDelimiterAndFileExtensionService=findDelimiterAndFileExtensionService;
	}
	/**
	 * POST  /file-templates : Create a new fileTemplates.
	 *
	 * @param fileTemplates the fileTemplates to create
	 * @return the ResponseEntity with status 201 (Created) and with body the new fileTemplates, or with status 400 (Bad Request) if the fileTemplates has already an ID
	 * @throws URISyntaxException if the Location URI syntax is incorrect
	 */
	@PostMapping("/file-templates/{userId}")
	@Timed
	public ResponseEntity<FileTemplates> createFileTemplates(@RequestBody FileTemplates fileTemplates,@RequestParam Long userId) throws URISyntaxException {
		log.debug("REST request to save FileTemplates : {}", fileTemplates);
		if (fileTemplates.getId() != null) {
			return ResponseEntity.badRequest().headers(HeaderUtil.createFailureAlert(ENTITY_NAME, "idexists", "A new fileTemplates cannot already have an ID")).body(null);
		}
		fileTemplates.setLastUpdatedDate(ZonedDateTime.now());
		fileTemplates.setCreatedDate(ZonedDateTime.now());
		fileTemplates.setCreatedBy(userId);
		fileTemplates.setLastUpdatedBy(userId);
		FileTemplates result = fileTemplatesRepository.save(fileTemplates);
		fileTemplatesSearchRepository.save(result);
		return ResponseEntity.created(new URI("/api/file-templates/" + result.getId()))
				.headers(HeaderUtil.createEntityCreationAlert(ENTITY_NAME, result.getId().toString()))
				.body(result);
	}

	/**
	 * PUT  /file-templates : Updates an existing fileTemplates.
	 *
	 * @param fileTemplates the fileTemplates to update
	 * @return the ResponseEntity with status 200 (OK) and with body the updated fileTemplates,
	 * or with status 400 (Bad Request) if the fileTemplates is not valid,
	 * or with status 500 (Internal Server Error) if the fileTemplates couldnt be updated
	 * @throws URISyntaxException if the Location URI syntax is incorrect
	 */
	@PutMapping("/file-templates/{userId}")
	@Timed
	public ResponseEntity<FileTemplates> updateFileTemplates(@RequestBody FileTemplates fileTemplates,@RequestParam Long userId) throws URISyntaxException {
		log.debug("REST request to update FileTemplates : {}", fileTemplates);
		if (fileTemplates.getId() == null) {
			return createFileTemplates(fileTemplates,userId);
		}
		fileTemplates.setLastUpdatedDate(ZonedDateTime.now());
		fileTemplates.setCreatedBy(userId);
		fileTemplates.setLastUpdatedBy(userId);
		FileTemplates result = fileTemplatesRepository.save(fileTemplates);
		fileTemplatesSearchRepository.save(result);
		return ResponseEntity.ok()
				.headers(HeaderUtil.createEntityUpdateAlert(ENTITY_NAME, fileTemplates.getId().toString()))
				.body(result);
	}

	/**
	 * GET  /file-templates : get all the fileTemplates.
	 *
	 * @param pageable the pagination information
	 * @return the ResponseEntity with status 200 (OK) and the list of fileTemplates in body
	 * @throws URISyntaxException 
	 */
	@GetMapping("/fileTemplatesByTenantId/{tenantId}")
	@Timed
	public ResponseEntity<List<FileTmpDTO>> getAllFileTemplates(@RequestParam(value = "page" , required = false) Integer offset,
			@RequestParam(value = "per_page", required = false) Integer limit,@RequestParam Long tenantId) throws URISyntaxException {
		log.debug("REST request to get a page of FileTemplates");
		List<FileTemplates> fileTemplateList=new ArrayList<FileTemplates>();
		PaginationUtil paginationUtil=new PaginationUtil();


		int maxlmt=paginationUtil.MAX_LIMIT;
		int minlmt=paginationUtil.MIN_OFFSET;
		log.info("maxlmt: "+maxlmt);
		Page<FileTemplates> page = null;
		HttpHeaders headers = null;

		if(limit==null || limit<minlmt){
			fileTemplateList=fileTemplatesRepository.findByTenantIdOrderByIdDesc(tenantId);
			log.info("fileTemplateList :"+fileTemplateList.size());
			log.info("offset :"+offset);
			limit=fileTemplateList.size();
		}
		if(limit == 0 )
		{
			limit = paginationUtil.DEFAULT_LIMIT;
		}
		if(offset == null || offset == 0)
		{
			offset = paginationUtil.DEFAULT_OFFSET;
		}
		if(limit>maxlmt)
		{
			log.info("input limit exceeds maxlimit");
			page =  page = fileTemplatesRepository.findByTenantIdOrderByIdDesc(tenantId,PaginationUtil.generatePageRequest2(offset, limit));
			headers = PaginationUtil.generatePaginationHttpHeaders2(page, "/api/fileTemplatesByTenantId",offset, limit);
		}
		else{
			log.info("input limit is within maxlimit");
			page = fileTemplatesRepository.findByTenantIdOrderByIdDesc(tenantId,PaginationUtil.generatePageRequest(offset, limit));
			headers = PaginationUtil.generatePaginationHttpHeaderss(page, "/api/fileTemplatesByTenantId", offset, limit);
		}
		List<FileTmpDTO> fileTmpList=new ArrayList<FileTmpDTO>();
		for(int i=0;i<page.getContent().size();i++)
		{
			FileTmpDTO fileTmpDTO=new FileTmpDTO();
			fileTmpDTO.setId(page.getContent().get(i).getId());
			if(page.getContent().get(i).getTemplateName()!=null && !page.getContent().get(i).getTemplateName().isEmpty())
			fileTmpDTO.setTemplateName(page.getContent().get(i).getTemplateName());
			if(page.getContent().get(i).getDescription()!=null && !page.getContent().get(i).getDescription().isEmpty())
			fileTmpDTO.setDescription(page.getContent().get(i).getDescription());
			if(page.getContent().get(i).getStartDate()!=null)
			fileTmpDTO.setStartDate(page.getContent().get(i).getStartDate());
			if(page.getContent().get(i).getEndDate()!=null)
			fileTmpDTO.setEndDate(page.getContent().get(i).getEndDate());
			if(page.getContent().get(i).getEndDate()!=null && page.getContent().get(i).getEndDate().isBefore(LocalDate.now()))
			{
			
			fileTmpDTO.setEndDated(true);
			}
			else
			{
				fileTmpDTO.setEndDated(false);
			}
			if(page.getContent().get(i).getStatus()!=null && !page.getContent().get(i).getStatus().isEmpty())
			fileTmpDTO.setStatus(page.getContent().get(i).getStatus());
			if(page.getContent().get(i).getFileType()!=null && !page.getContent().get(i).getFileType().isEmpty())
			fileTmpDTO.setFileType(page.getContent().get(i).getFileType());
			if(page.getContent().get(i).getDelimiter()!=null && !page.getContent().get(i).getDelimiter().isEmpty())
			{
				LookUpCode lookup = new LookUpCode();
				lookup = lookUpCodeRepository.findByLookUpTypeAndLookUpCodeAndTenantId("DELIMITER",page.getContent().get(i).getDelimiter(),  tenantId);
				if(lookup != null && lookup.getDescription() != null )
				fileTmpDTO.setDelimiter(lookup.getDescription());
			}
			
			if(page.getContent().get(i).getSource()!=null && !page.getContent().get(i).getSource().isEmpty())
			fileTmpDTO.setSource(page.getContent().get(i).getSource());
			if(page.getContent().get(i).getSkipRowsStart()!=null)
			fileTmpDTO.setSkipRowsStart(page.getContent().get(i).getSkipRowsStart());
			if(page.getContent().get(i).getSkipRowsEnd()!=null)
			fileTmpDTO.setSkipRowsEnd(page.getContent().get(i).getSkipRowsEnd());
			if(page.getContent().get(i).getNumber_of_columns()!=null)
			fileTmpDTO.setNumberOfColumns(page.getContent().get(i).getNumber_of_columns());
			if(page.getContent().get(i).getHeaderRowNumber()!=null)
			fileTmpDTO.setHeaderRowNumber(page.getContent().get(i).getHeaderRowNumber());
			fileTmpDTO.setTenantId(tenantId);
			if(page.getContent().get(i).getCreatedBy()!=null)
			fileTmpDTO.setCreatedBy(page.getContent().get(i).getCreatedBy());
			if(page.getContent().get(i).getCreatedDate()!=null)
			fileTmpDTO.setCreatedDate(page.getContent().get(i).getCreatedDate());
			if(page.getContent().get(i).getLastUpdatedBy()!=null)
			fileTmpDTO.setLastUpdatedBy(page.getContent().get(i).getLastUpdatedBy());
			if(page.getContent().get(i).getLastUpdatedDate()!=null)
			fileTmpDTO.setLastUpdatedDate(page.getContent().get(i).getLastUpdatedDate());
			if(page.getContent().get(i).getData()!=null && !page.getContent().get(i).getData().isEmpty())
			fileTmpDTO.setData(page.getContent().get(i).getData());
			if(page.getContent().get(i).getSdFilename()!=null && !page.getContent().get(i).getSdFilename().isEmpty())
			fileTmpDTO.setSdFilename(page.getContent().get(i).getSdFilename());
			if(page.getContent().get(i).getRowIdentifier()!=null && !page.getContent().get(i).getRowIdentifier().isEmpty())
			fileTmpDTO.setRowIdentifier(page.getContent().get(i).getRowIdentifier());
			fileTmpList.add(fileTmpDTO);
		}
		
		
		
		return new ResponseEntity<>(fileTmpList, headers, HttpStatus.OK);

	}

	/**
	 * GET  /file-templates/:id : get the "id" fileTemplates.
	 *
	 * @param id the id of the fileTemplates to retrieve
	 * @return the ResponseEntity with status 200 (OK) and with body the fileTemplates, or with status 404 (Not Found)
	 */
	@GetMapping("/file-templates/{id}")
	@Timed
	public ResponseEntity<FileTempDTO> getFileTemplates(@PathVariable Long id) {
		log.debug("REST request to get FileTemplates : {}", id);
		FileTemplates fileTemplates = fileTemplatesRepository.findOne(id);
		FileTempDTO fileTempDTO = new FileTempDTO();
		fileTempDTO.setCreatedBy(fileTemplates.getCreatedBy());
		fileTempDTO.setDelimiter(fileTemplates.getDelimiter());
		fileTempDTO.setDescription(fileTemplates.getDescription());
		fileTempDTO.setEndDate(fileTemplates.getEndDate());
		fileTempDTO.setFileType(fileTemplates.getFileType());
		fileTempDTO.setHeaderRowNumber(fileTemplates.getHeaderRowNumber());
		fileTempDTO.setId(fileTemplates.getId());
		fileTempDTO.setLastUpdatedBy(fileTemplates.getLastUpdatedBy());
		fileTempDTO.setNumberOfColumns(fileTemplates.getNumber_of_columns());
		if(fileTemplates.getData() != null && !fileTemplates.getData().isEmpty() && !fileTemplates.getData().equals(""))
		{
			SampleDataDTO sampleDataDTO  =  new SampleDataDTO();
			sampleDataDTO = findDelimiterAndFileExtensionService.displayingBlobData(fileTemplates.getData());
			fileTempDTO.setSampleData(sampleDataDTO.getSampleData());
			fileTempDTO.setColHeaders(sampleDataDTO.getColHeaders());
		}
		fileTempDTO.setSdFilename(fileTemplates.getSdFilename());
		fileTempDTO.setSkipRowsEnd(fileTemplates.getSkipRowsEnd());
		fileTempDTO.setSkipRowsStart(fileTemplates.getSkipRowsStart());
		fileTempDTO.setSource(fileTemplates.getSource());
		fileTempDTO.setStartDate(fileTemplates.getStartDate());
		fileTempDTO.setStatus(fileTemplates.getStatus());
		fileTempDTO.setTemplateName(fileTemplates.getTemplateName());
		fileTempDTO.setTenantId(fileTemplates.getTenantId());
		List<FileTemplateLines> rowIdentifierLine = fileTemplateLinesRepository.findByTemplateIdAndRecordTYpe(id, "Row Identifier");
		if(rowIdentifierLine != null && rowIdentifierLine.size()>0 && rowIdentifierLine.get(0).getRecordIdentifier()!=null)
		{
			fileTempDTO.setRowIdentifier(rowIdentifierLine.get(0).getRecordIdentifier());
		}
		return ResponseUtil.wrapOrNotFound(Optional.ofNullable(fileTempDTO));
	}

	/**
	 * DELETE  /file-templates/:id : delete the "id" fileTemplates.
	 *
	 * @param id the id of the fileTemplates to delete
	 * @return the ResponseEntity with status 200 (OK)
	 */
	@DeleteMapping("/file-templates/{id}")
	@Timed
	public ResponseEntity<Void> deleteFileTemplates(@PathVariable Long id) {
		log.debug("REST request to delete FileTemplates : {}", id);
		fileTemplatesRepository.delete(id);
		fileTemplatesSearchRepository.delete(id);
		return ResponseEntity.ok().headers(HeaderUtil.createEntityDeletionAlert(ENTITY_NAME, id.toString())).build();
	}

	/**
	 * SEARCH  /_search/file-templates?query=:query : search for the fileTemplates corresponding
	 * to the query.
	 *
	 * @param query the query of the fileTemplates search 
	 * @param pageable the pagination information
	 * @return the result of the search
	 */
	@GetMapping("/_search/file-templates")
	@Timed
	public ResponseEntity<List<FileTemplates>> searchFileTemplates(@RequestParam String query, @ApiParam Pageable pageable) {
		log.debug("REST request to search for a page of FileTemplates for query {}", query);
		Page<FileTemplates> page = fileTemplatesSearchRepository.search(queryStringQuery(query), pageable);
		HttpHeaders headers = PaginationUtil.generateSearchPaginationHttpHeaders(query, page, "/api/_search/file-templates");
		return new ResponseEntity<>(page.getContent(), headers, HttpStatus.OK);
	}
	/**
	 * Author : Shobha
	 * @param file
	 * @return
	 * @throws IOException 
	 */
	@PostMapping("/fileUpload")
	@Timed
	public StatusStringDTO fileUpload(@RequestParam MultipartFile file) throws IOException
	{
		log.debug("Rest request for file upload");
		StatusStringDTO statusDTo = new StatusStringDTO();

		try {
			InputStream is = file.getInputStream();
			OutputStream os = new FileOutputStream("/home/nspl/Files/sample.csv");
			byte[] buffer = new byte[1024];
			int bytesRead;
			//read from is to buffer
			while((bytesRead = is.read(buffer)) !=-1){
				os.write(buffer, 0, bytesRead);
			}
			is.close();
			//flush OutputStream to write any buffered data to file
			os.flush();
			os.close();
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		/*if(file.getOriginalFilename() != null)
			statusDTo.setStatus("success");
		else
			statusDTo.setStatus("failure");*/
		return statusDTo;
	}
	/**
	 * Author : Shobha
	 * @param file
	 * @return
	 */
	@PostMapping("/multipleFileUpload")
	@Timed
	public StatusStringDTO multipleFileUpload(@RequestParam List<MultipartFile> file)
	{
		log.debug("Rest request to file upload"+file.size());
		log.info("file name is:"+file.get(0).getOriginalFilename());
		StatusStringDTO statusDTo = new StatusStringDTO();
		if(file.get(0).getOriginalFilename() != null)
			statusDTo.setStatus("success");
		else
			statusDTo.setStatus("failure");
		return statusDTo;
	}



	/**
	 * Auhtor:Ravali
	 *@param templateId
	 * @return sourceAssignmnetProfile and sourceProfile(DTO)
	 */
	@GetMapping("/getSourceProfileAssigAndSourceProfile")
	@Timed
	public List<FileTemplateDTO> fetchfileTemplateDTO(@RequestParam Long templateId)
	{
		List<FileTemplateDTO> fileTemplateDtoList=new ArrayList<FileTemplateDTO>();

		SourceProfileFileAssignments sourceProfileAssignment = sourceProfileFileAssignmentsRepository.findByTemplateId(templateId);
		if(sourceProfileAssignment != null)
		{
			FileTemplateDTO fileTemplateDto=new FileTemplateDTO();
			fileTemplateDto.setSPAId(sourceProfileAssignment.getId());
			if(sourceProfileAssignment.getSourceProfileId()!=null)
				fileTemplateDto.setSourceProfileId(sourceProfileAssignment.getSourceProfileId());
			if(sourceProfileAssignment.getFileNameFormat()!=null&&!sourceProfileAssignment.getFileNameFormat().isEmpty())
				fileTemplateDto.setFileNameFormat(sourceProfileAssignment.getFileNameFormat());
			if(sourceProfileAssignment.getFileDescription()!=null&&!sourceProfileAssignment.getFileDescription().isEmpty())
				fileTemplateDto.setFileDescription(sourceProfileAssignment.getFileDescription());
			if(sourceProfileAssignment.getFileExtension()!=null&&!sourceProfileAssignment.getFileExtension().isEmpty())
				fileTemplateDto.setFileExtension(sourceProfileAssignment.getFileExtension());
			if(sourceProfileAssignment.getFrequencyType()!=null&&!sourceProfileAssignment.getFrequencyType().isEmpty())
				fileTemplateDto.setFrequencyType(sourceProfileAssignment.getFrequencyType());
			if(sourceProfileAssignment.getDueTime()!=null&&!sourceProfileAssignment.getDueTime().isEmpty())
				fileTemplateDto.setDueTime(sourceProfileAssignment.getDueTime());
			if(sourceProfileAssignment.getDay()!=null)
				fileTemplateDto.setDay(sourceProfileAssignment.getDay());
			if(sourceProfileAssignment.getSourceDirectoryPath()!=null&&!sourceProfileAssignment.getSourceDirectoryPath().isEmpty())
				fileTemplateDto.setSourceDirectoryPath(sourceProfileAssignment.getSourceDirectoryPath());
			if(sourceProfileAssignment.getLocalDirectoryPath()!=null&&!sourceProfileAssignment.getLocalDirectoryPath().isEmpty())
				fileTemplateDto.setLocalDirectoryPath(sourceProfileAssignment.getLocalDirectoryPath());
			if(sourceProfileAssignment.getTemplateId()!=null)
				fileTemplateDto.setTemplateId(sourceProfileAssignment.getTemplateId());
			if(sourceProfileAssignment.isEnabledFlag()!=null)
				fileTemplateDto.setSPAEnabledFlag(sourceProfileAssignment.isEnabledFlag());
			if(sourceProfileAssignment.getCreatedBy()!=null)
				fileTemplateDto.setSPACreatedBy(sourceProfileAssignment.getCreatedBy());
			if(sourceProfileAssignment.getCreatedDate()!=null)
				fileTemplateDto.setSPACreationDate(sourceProfileAssignment.getCreatedDate());
			if(sourceProfileAssignment.getLastUpdatedBy()!=null)
				fileTemplateDto.setSPALastUpdatedBy(sourceProfileAssignment.getLastUpdatedBy());
			if(sourceProfileAssignment.getLastUpdatedDate()!=null)
				fileTemplateDto.setSPALastUpdatedDate(sourceProfileAssignment.getLastUpdatedDate());


			if(sourceProfileAssignment.getSourceProfileId()!=null)
			{
				SourceProfiles sourceProfiles=sourceProfilesRepository.findOne(sourceProfileAssignment.getSourceProfileId());

				if(sourceProfiles.getSourceProfileName()!=null&&!sourceProfiles.getSourceProfileName().isEmpty())
					fileTemplateDto.setSourceProfileName(sourceProfiles.getSourceProfileName());
				if(sourceProfiles.getDescription()!=null&&!sourceProfiles.getDescription().isEmpty())
					fileTemplateDto.setDescription(sourceProfiles.getDescription());
				if(sourceProfiles.getStartDate()!=null)
					fileTemplateDto.setStartDate(sourceProfiles.getStartDate());
				if(sourceProfiles.getEndDate()!=null)
					fileTemplateDto.setEndDate(sourceProfiles.getEndDate());
				if(sourceProfiles.isEnabledFlag()!=null)
					fileTemplateDto.setSourceProfileEnableFlag(sourceProfiles.isEnabledFlag());
				if(sourceProfiles.getConnectionId()!=null)
					fileTemplateDto.setConnectionId(sourceProfiles.getConnectionId());
				if(sourceProfiles.getTenantId()!=null)
					fileTemplateDto.setTenantId(sourceProfiles.getTenantId());
				if(sourceProfiles.getCreatedBy()!=null)
					fileTemplateDto.setSourceProfileCreatedBy(sourceProfiles.getCreatedBy());
				if(sourceProfiles.getCreatedDate()!=null)
					fileTemplateDto.setSourceProfileCreationDate(sourceProfiles.getCreatedDate());
				if(sourceProfiles.getLastUpdatedBy()!=null)
					fileTemplateDto.setSourceProfileLastUpdatedBy(sourceProfiles.getLastUpdatedBy());
				if(sourceProfiles.getLastUpdatedDate()!=null)
					fileTemplateDto.setSourceProfileLastUpdateDate(sourceProfiles.getLastUpdatedDate());
			}
			fileTemplateDtoList.add(fileTemplateDto);
		}
		return fileTemplateDtoList;

	}


	/**
	 * Auhtor:Ravali
	 *@param FileTemplatesPostingDTO
	 * @return ErrorReport
	 */
	@PostMapping("/FileTemplatesPostingDTO")
	@Timed
	public List<ErrorReport> postingFileTempAndFileTempLinesAndSPA(@RequestBody FileTemplatesPostingDTO fileTemplatesPostingDTO)
	{
		//	User currentUser=userService.getCurrentUser();
		//	Long tenantId=currentUser.getTenantId();
		List<ErrorReport> finalErrorReport=new ArrayList<ErrorReport>();
		FileTemplates filetempRecord=new FileTemplates();
		log.info("Rest Request to post File template , File Template Lines and source profile assignments");
		String save="Failure";
		int count=0;
		if(fileTemplatesPostingDTO!=null)
		{
			//save FileTemplates
			FileTemplates fileTemplate=new FileTemplates();
			if(fileTemplatesPostingDTO.getFileTempDTO()!=null)
			{
				FileTempDTO fileTempDTO=fileTemplatesPostingDTO.getFileTempDTO();
				if(fileTempDTO.getId()!=null)
				{
					fileTemplate.setId(fileTempDTO.getId());
				}
				if(fileTempDTO.getTemplateName()!=null&&!fileTempDTO.getTemplateName().isEmpty())
					fileTemplate.setTemplateName(fileTempDTO.getTemplateName());
				if(fileTempDTO.getDescription()!=null&&!fileTempDTO.getDescription().isEmpty())
					fileTemplate.setDescription(fileTempDTO.getDescription());
				if(fileTempDTO.getStartDate()!=null)
					fileTemplate.setStartDate(fileTempDTO.getStartDate().plusDays(1));
				if(fileTempDTO.getEndDate()!=null)
					fileTemplate.setEndDate(fileTempDTO.getEndDate().plusDays(1));
				if(fileTempDTO.getStatus()!=null&&!fileTempDTO.getStatus().isEmpty())
					fileTemplate.setStatus(fileTempDTO.getStatus());
				else
					fileTemplate.setStatus("Active");
				if(fileTempDTO.getFileType()!=null&&!fileTempDTO.getFileType().isEmpty())
					fileTemplate.setFileType(fileTempDTO.getFileType());
				if(fileTempDTO.getFileType()!=null&&!fileTempDTO.getFileType().isEmpty())
					fileTemplate.setDelimiter(fileTempDTO.getDelimiter());
				if(fileTempDTO.getSource()!=null&&!fileTempDTO.getSource().isEmpty())
					fileTemplate.setSource(fileTempDTO.getSource());
				if(fileTempDTO.getSkipRowsStart()!=null)
					fileTemplate.setSkipRowsStart(fileTempDTO.getSkipRowsStart());
				if(fileTempDTO.getSkipRowsEnd()!=null)
					fileTemplate.setSkipRowsEnd(fileTempDTO.getSkipRowsEnd());
				if(fileTempDTO.getNumberOfColumns()!=null)
					fileTemplate.setNumber_of_columns(fileTempDTO.getNumberOfColumns());
				if(fileTempDTO.getHeaderRowNumber()!=null)
					fileTemplate.setHeaderRowNumber(fileTempDTO.getHeaderRowNumber());
				if(fileTempDTO.getSampleData().size() > 0)
				{
					String sampleDataConvToBlob = "";
					sampleDataConvToBlob = findDelimiterAndFileExtensionService.savingBlobData(fileTempDTO.getSampleData());
					if(sampleDataConvToBlob != null && !sampleDataConvToBlob.isEmpty() && !sampleDataConvToBlob.equals(""))
					{
						fileTemplate.setData(sampleDataConvToBlob);
					}
				}
				if(fileTempDTO.getTenantId()!=null)
					fileTemplate.setTenantId(fileTempDTO.getTenantId());
				if(fileTempDTO.getCreatedBy()!=null)
					fileTemplate.setCreatedBy(fileTempDTO.getCreatedBy());
				if(fileTempDTO.getLastUpdatedBy()!=null)
					fileTemplate.setLastUpdatedBy(fileTempDTO.getLastUpdatedBy());
				fileTemplate.setCreatedDate(ZonedDateTime.now());
				fileTemplate.setLastUpdatedDate(ZonedDateTime.now());
				//if(fileTemplate!=null)
				//By Kiran to set sample data filename
				if(fileTempDTO.getSdFilename()!=null)
					fileTemplate.setSdFilename(fileTempDTO.getSdFilename());
				filetempRecord=fileTemplatesRepository.save(fileTemplate);
				ErrorReport fileTempErrorReport=new ErrorReport();
				fileTempErrorReport.setTaskName("File Template Save");
				log.info("fileTemplate :"+fileTemplate);
				if(filetempRecord.getId()!=null)
				{
					count=1;
					fileTempErrorReport.setTaskStatus("Success");
					fileTempErrorReport.setDetails(filetempRecord.getId()+"");
					finalErrorReport.add(fileTempErrorReport);
				}
				else{
					fileTempErrorReport.setTaskStatus("Failure");
					finalErrorReport.add(fileTempErrorReport);
				}
			}
			if(filetempRecord.getId()!=null)
			{
				List<FileTemplateLinesDTO> FileTemplateLinesList=fileTemplatesPostingDTO.getFileTemplateLinesDTO();
				if(FileTemplateLinesList.size()>0)
				{
					List<FileTemplateLines> fileTempLinesList=new ArrayList<FileTemplateLines>();
					String str="";
					ErrorReport fileTempLinesErrReport=new ErrorReport();

					for(int i=0;i<FileTemplateLinesList.size();i++)
					{
						FileTemplateLinesDTO fileTempLinesDTO=FileTemplateLinesList.get(i);
						//						log.info("fileTempLinesDTO printing1:"+fileTempLinesDTO.getRecordType());
						FileTemplateLines fileTempLines=new FileTemplateLines();
						if(fileTempLinesDTO.getColumnHeader() !=null&&!fileTempLinesDTO.getColumnHeader().isEmpty())
						{
							//log.info("fileTempLinesDTO.getColumnHeader()2:- "+fileTempLinesDTO.getColumnHeader());
							if(fileTempLinesDTO.getId()!=null)
							{
								fileTempLines.setId(fileTempLinesDTO.getId());
							}
							if(filetempRecord.getId()!=null)
								fileTempLines.setTemplateId(filetempRecord.getId());
							if(fileTempLinesDTO.getLineNumber()!=null)
								fileTempLines.setLineNumber(fileTempLinesDTO.getLineNumber());
							if(fileTempLinesDTO.getMasterTableReferenceColumn()!=null)
								fileTempLines.setMasterTableReferenceColumn(fileTempLinesDTO.getMasterTableReferenceColumn());
							if(fileTempLinesDTO.getRecordTYpe()!=null&&!fileTempLinesDTO.getRecordTYpe().isEmpty())
							{
																//log.info("fileTempLinesDTO printing2:"+fileTempLinesDTO.getRecordTYpe());
								fileTempLines.setRecordTYpe(fileTempLinesDTO.getRecordTYpe());
							}else
								fileTempLines.setRecordTYpe("Row Data");
														//log.info("fileTempLinesDTO printing3:"+fileTempLines.getRecordTYpe());

							fileTempLines.setRecordIdentifier(fileTempLinesDTO.getRecordIdentifier());
							if(fileTempLinesDTO.getColumnNumber()!=null)
								fileTempLines.setColumnNumber(fileTempLinesDTO.getColumnNumber());
							if(fileTempLinesDTO.getEnclosedChar()!=null&&!fileTempLinesDTO.getEnclosedChar().isEmpty())
								fileTempLines.setEnclosedChar(fileTempLinesDTO.getEnclosedChar());
							if(fileTempLinesDTO.getEnclosedChar()!=null&&!fileTempLinesDTO.getEnclosedChar().isEmpty())
								fileTempLines.setEnclosedChar(fileTempLinesDTO.getEnclosedChar());
							if(fileTempLinesDTO.getPositionBegin()!=null)
								fileTempLines.setPositionBegin(fileTempLinesDTO.getPositionBegin());
							if(fileTempLinesDTO.getPositionEnd()!=null)
								fileTempLines.setPositionEnd(fileTempLinesDTO.getPositionEnd());
							if(fileTempLinesDTO.getColumnHeader()!=null&&!fileTempLinesDTO.getColumnHeader().isEmpty())
								fileTempLines.setColumnHeader(fileTempLinesDTO.getColumnHeader());
							if(fileTempLinesDTO.getColumnHeader()!=null&&!fileTempLinesDTO.getColumnHeader().isEmpty())
								fileTempLines.setConstantValue(fileTempLinesDTO.getConstantValue());
							if(fileTempLinesDTO.getZeroFill()!=null&&!fileTempLinesDTO.getZeroFill().isEmpty())
								fileTempLines.setZeroFill(fileTempLinesDTO.getZeroFill());
							if(fileTempLinesDTO.getAlign()!=null&&!fileTempLinesDTO.getAlign().isEmpty())
								fileTempLines.setAlign(fileTempLinesDTO.getAlign());
							if(fileTempLinesDTO.getFormula()!=null&&!fileTempLinesDTO.getFormula().isEmpty())
								fileTempLines.setFormula(fileTempLinesDTO.getFormula());
							if(fileTempLinesDTO.getDateFormat()!=null&&!fileTempLinesDTO.getDateFormat().isEmpty())
								fileTempLines.setDateFormat(fileTempLinesDTO.getDateFormat());
							if(fileTempLinesDTO.getTimeFormat()!=null&&!fileTempLinesDTO.getTimeFormat().isEmpty())
								fileTempLines.setTimeFormat(fileTempLinesDTO.getTimeFormat());
							if(fileTempLinesDTO.getAmountFormat()!=null&&!fileTempLinesDTO.getAmountFormat().isEmpty())
								fileTempLines.setAmountFormat(fileTempLinesDTO.getAmountFormat());
							if(fileTempLinesDTO.getAmountFormat()!=null&&!fileTempLinesDTO.getAmountFormat().isEmpty())
								fileTempLines.setOverFlow(fileTempLinesDTO.getOverFlow());
							if(fileTempLinesDTO.getSkipColumn()!=null&&!fileTempLinesDTO.getSkipColumn().isEmpty())
								fileTempLines.setSkipColumn(fileTempLinesDTO.getSkipColumn());
							if(fileTempLinesDTO.getColumnDelimeter()!=null&&!fileTempLinesDTO.getColumnDelimeter().isEmpty())
								fileTempLines.setColumnDelimiter(fileTempLinesDTO.getColumnDelimeter());
							if(fileTempLinesDTO.getCreatedBy()!=null)
								fileTempLines.setCreatedBy(fileTempLinesDTO.getCreatedBy());

							fileTempLines.setCreatedDate(ZonedDateTime.now());
							if(fileTempLinesDTO.getLastUpdatedBy()!=null)
								fileTempLines.setLastUpdatedBy(fileTempLinesDTO.getCreatedBy());
							fileTempLines.setLastUpdatedDate(ZonedDateTime.now());

							
							
						//	if(fileTempLinesDTO.getColumnHeader().)
							// Swetha
							/* Logic to process column header and save it in column alias */
							String s=fileTempLinesDTO.getColumnHeader();
							//Tested Format eg: String s="as%-???^&df_#S";
							Pattern pattern = Pattern.compile("[^a-z A-Z 0-9]");
							Matcher matcher = pattern.matcher(s);
							String number = matcher.replaceAll("");
							//log.info("number: "+number);

							String finalCol="";
							String b[]=number.split("\\s+");
							for(int l=0;l<b.length;l++){
								b[l]=b[l].replace(b[l].charAt(0), Character.toTitleCase(b[l].charAt(0)));
								finalCol=finalCol.concat(b[l]);
							}

							//log.info("finalCol: "+finalCol);
							fileTempLines.setColumnAlias(finalCol+"_"+filetempRecord.getId());


							FileTemplateLines fileTempLine=fileTemplateLinesRepository.save(fileTempLines);
							fileTempLinesList.add(fileTempLine);
							//log.info("fileTempLinesDTO.line: :"+fileTempLinesDTO.getLineNumber());
							if(fileTempLine!=null&&fileTempLine.getId()!=null)
							{
								fileTempLinesErrReport.setTaskName("File Template Lines Save");
								fileTempLinesErrReport.setTaskStatus("Success");

							}
							else
							{
								fileTempLinesErrReport.setTaskName("File Template Lines Save");
								fileTempLinesErrReport.setTaskStatus("Failure");
								str=str+fileTempLinesDTO.getLineNumber()+",";
								//fileTempLinesErrReport.setDetails("Failed to save at line number :"+str);
							}
						}

					}
					//removing "," for last string
					if (str.endsWith(",")) {
						str = str.substring(0, str.length() - 1);
					}
					if(fileTempLinesErrReport.getTaskStatus()!=null&&fileTempLinesErrReport.getTaskStatus().equalsIgnoreCase("failure"))
					{
						fileTempLinesErrReport.setDetails("Failed to save at line number :"+str);
						if(fileTempLinesErrReport!=null&&fileTempLinesErrReport.getTaskStatus()!=null)
							finalErrorReport.add(fileTempLinesErrReport);
					}
					if(fileTempLinesErrReport.getTaskStatus()!=null && fileTempLinesErrReport.getTaskStatus().equalsIgnoreCase("Success"))
					{
						ErrorReport fileTempLinesErrorReport=new ErrorReport();
						fileTempLinesErrorReport.setTaskName("File Template Lines Save");
						if(FileTemplateLinesList.size()==fileTempLinesList.size())
						{
							count=2;
							fileTempLinesErrorReport.setTaskStatus("Success");
							finalErrorReport.add(fileTempLinesErrorReport);
						}
						else
						{
							fileTempLinesErrorReport.setTaskStatus("Failure");

							finalErrorReport.add(fileTempLinesErrorReport);
						}
					}

				}


				SourceProfileFileAssignments SPA=new SourceProfileFileAssignments();
				if(fileTemplatesPostingDTO.getSourceProfileFileAssignmentDTO()!=null && fileTemplatesPostingDTO.getSourceProfileFileAssignmentDTO().getSourceProfileId() != null)
				{
					SourceProfileFileAssignmentDTO SPADTO=fileTemplatesPostingDTO.getSourceProfileFileAssignmentDTO();
					log.info("SPADTO: temp id:"+SPADTO.getTemplateId());
					if(SPADTO.getId()!=null)
					{
						SPA.setId(SPADTO.getId());
					}
					if(SPADTO.getSourceProfileId()!=null)
						SPA.setSourceProfileId(SPADTO.getSourceProfileId());
					if(SPADTO.getFileNameFormat()!=null&&!SPADTO.getFileNameFormat().isEmpty())
						SPA.setFileNameFormat(SPADTO.getFileNameFormat());
					if(SPADTO.getFileDescription()!=null&&!SPADTO.getFileDescription().isEmpty())
						SPA.setFileDescription(SPADTO.getFileDescription());
					if(SPADTO.getFileExtension()!=null&&!SPADTO.getFileExtension().isEmpty())
						SPA.setFileExtension(SPADTO.getFileExtension());
					if(SPADTO.getFrequencyType()!=null&&!SPADTO.getFrequencyType().isEmpty())
						SPA.setFrequencyType(SPADTO.getFrequencyType());
					if(SPADTO.getDueTime()!=null&&!SPADTO.getDueTime().isEmpty())
						SPA.setDueTime(SPADTO.getDueTime());
					if(SPADTO.getDay()!=null)
						SPA.setDay(SPADTO.getDay());
					if(SPADTO.getSourceDirectoryPath()!=null&&!SPADTO.getSourceDirectoryPath().isEmpty())
						SPA.setSourceDirectoryPath(SPADTO.getSourceDirectoryPath());
					if(SPADTO.getLocalDirectoryPath()!=null&&!SPADTO.getLocalDirectoryPath().isEmpty())
						SPA.setLocalDirectoryPath(SPADTO.getLocalDirectoryPath());
					if(filetempRecord.getId()!=null)
						SPA.setTemplateId(filetempRecord.getId());
					SPA.setEnabledFlag(true);
					if(SPADTO.getCreatedBy()!=null)
						SPA.setCreatedBy(SPADTO.getCreatedBy());
					SPA.setCreatedDate(ZonedDateTime.now());
					if(SPADTO.getLastUpdatedBy()!=null)
						SPA.setLastUpdatedBy(SPADTO.getLastUpdatedBy());
					SPA.setLastUpdatedDate(ZonedDateTime.now());

					SourceProfileFileAssignments sourceProfileAssgn=sourceProfileFileAssignmentsRepository.save(SPA);

					ErrorReport fileTempLinesErrorReport=new ErrorReport();
					fileTempLinesErrorReport.setTaskName("Source Profile Assignment Save");
					if(sourceProfileAssgn.getId()!=null)
					{
						count=3;
						fileTempLinesErrorReport.setTaskStatus("Success");
						finalErrorReport.add(fileTempLinesErrorReport);
					}
					else
					{
						fileTempLinesErrorReport.setTaskStatus("Failure");
						finalErrorReport.add(fileTempLinesErrorReport);

					}
				}
			}			if(count==3)
			{
				save="Success";
			}
		}
		return finalErrorReport;


	}

	/*
	 *//**Auhtor:Ravali
	 * @return details of source column values in a hashMap
	 *//*
	@GetMapping("/getFileTempMap")
	@Timed
	public List<HashMap> getFileTemp()
	{
		log.info("Rest Request to get distinct source details");
		//log.info("columnName :"+columnName);
		List<String> distinctList=fileTemplatesRepository.fetchDistinct();
		log.info("distinctList :"+distinctList);
		List<HashMap> FinalMap=new ArrayList<HashMap>();
		int k=0;
		for(int i=0;i<distinctList.size();i++)
		{
			HashMap map1=new HashMap();
			k=k+1;
			map1.put("id",k);
			map1.put("Source", distinctList.get(i));
			String displayName=distinctList.get(i).replaceAll("\\W", " ");
			map1.put("dispname", displayName);
			String img="";
			if(distinctList.get(i).equalsIgnoreCase("Chase"))
			{
				img="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAk1BMVEX///8AXLnw8PEAWLcYZrQAYMIAXr1ahbFOfaxKi818q9vt7u5bibhLfrEXaLoib73Y29/29vcsdsDR194accne4eS4w89ChMcNacXn6es5drjBzdoXbMJmndUAZcuktMVljLSctMw2fMOSrMd6nL9xn81UldYfbr0JZ8RJf7aYveOFnrxnlME/fbwKYLamwNuFs+KsN3Y0AAABXElEQVRIie3W23KCMBAG4ATctB4QAyIirQdapUht+/5P14gKG7JBOtObzvS/5f8gM4ENjLUjjyOco1HAGUvGSnC1TKS9H50SxibAtYBnFUnw4ZiAQ2ER4wwGFOAQO1TfyUDQgEOWmH0ZA7cBSshC9ayAQxAR/Q7AwZ9p4NLqABzy0Oh3Ai7mjXi/djqBEmmrfwPClrdF1d/Xt6zAdjqwJj8/o2yWUAHp2DNW1z9droN7Gf0+KAuvzmTWA3hraHLoAR7QxrjDf/BXwZeLvpA+IFpNm6x6ADUiUYi+Ce5FA88/A7BSa4geO7KVGEBQjdgN/kBaecIA/OuAXSwFpyN8BERej9fUJjDAo5Klc1ogoPUZC2nRALFMmZYwp0QNbmMVZeYTU7sGZl/tR2CKG1hvqB0lxBXAjn4HkqwtLmD9QvfVexsDAbxXW18d7if9x8Q9g9DeV6fJfohzSI3GNxONHJoVvN79AAAAAElFTkSuQmCC";
			}
			else if(distinctList.get(i).equalsIgnoreCase("BOA"))
			{
				img="data:image/png;base64,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";
			}
			else if(distinctList.get(i).equalsIgnoreCase("Wellsforgo"))
			{
				img="http://www.montrosechamber.org/wp-content/sabai/File/files/664e01a80cd59928f6152513282a9f9c.png";
			}
			else if(distinctList.get(i).equalsIgnoreCase("Citi"))
			{
				img="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAP1BMVEX///8AAJkzM8ymyvBmZsz/AACZmcwAAMzMzP//MzP/mZn/Zmb/zMwAM8z/fID/UFDx8fH/mczM7P/j4+Pq6urRYjM3AAAAuklEQVQ4jeWRSQKDIAxFMxFQtHa6/1mbQNUWtd23WTD9l08IAD8Zw9SFELp8OR/IrnaFGXb03s77ujKm3+inELLPwnVzaoGcSxKhFpM8HdRJyO1REiJxb0nAEpFEfbPogh6RIZo52QqRICG+6KRKKMWcdURRNiDO/rEWpfPtdVwBxfG9vBYQlG8AfQZ4LXcfsMeVO+QQUHu5eHsWgJTgugJgPbCgBOMzt2kUwI2l/CDrvWZ4Y3TzI/8cDzOPBHXjaCmjAAAAAElFTkSuQmCC";
			}
			map1.put("imagePath",img);
			List<HashMap> templateListMap=new ArrayList<HashMap>();
			List<FileTemplates> fileTempList=fileTemplatesRepository.findBySource(distinctList.get(i));
			log.info("fileTempList :"+fileTempList);
			for(FileTemplates fileTemp:fileTempList)
			{
				HashMap map2=new HashMap();
				map2.put("tempId", fileTemp.getId());
				map2.put("templateName", fileTemp.getTemplateName());
				templateListMap.add(map2);
			}
			log.info("templateListMap :"+templateListMap);
			map1.put("templateList", templateListMap);
			FinalMap.add(map1);
		}
		return FinalMap;
	}
	  */


	/**Auhtor:Ravali
	 * @param tableName
	 * @param columnName
	 * @return details of column values in a hashMap
	 */
	@GetMapping("/fetchFileTemplateByColumnNameAndTableName/{tableName}/{columnName}")
	@Timed
	public List<HashMap> getFileTempList(@PathVariable String tableName,@PathVariable String columnName, @RequestParam Long tenantId)
	{
		log.info("Rest Request to get distinct source details");
		log.info("columnName :"+columnName);


		Query distinctList=em.createQuery("select distinct"+"("+columnName+")"+ " FROM "+tableName+" where tenant_id="+tenantId);
		log.info("distinctList : "+distinctList);
		List distinct = new ArrayList<String>();
		distinct =distinctList.getResultList();

		log.info("distinctList :"+distinctList);
		log.info("distinct :"+distinct);

		List<HashMap> FinalMap=new ArrayList<HashMap>();
		int k=0;
		for(int i=0;i<distinct.size();i++)
		{
			if(tableName.equalsIgnoreCase("RuleGroup"))
			{

				if(distinct.get(i) != null)
				{
					HashMap ruleGroupMap = new HashMap();
					log.info("distinct.get(i) :"+(distinct.get(i)));
					List ruleGrpList=em.createQuery("select id FROM RuleGroup where tenantId="+tenantId +"and "+columnName+" ='"+distinct.get(i).toString()+"'").getResultList();
					log.info("ruleGrpList :"+ruleGrpList);
					List<HashMap> ruleGroupsListMap=new ArrayList<HashMap>();
					
					for(int j=0;j<ruleGrpList.size();j++)
					{
						HashMap ruleGroupWithRulesMap = new HashMap();
						HashMap ruleMap=new HashMap();
						log.info("Long.valueOf(ruleGrpList.get(j).toString()) :"+Long.valueOf(ruleGrpList.get(j).toString()));
						List<RuleGroupDetails> ruleGrpDetailsList=ruleGroupDetailsRepository.findByRuleGroupId(Long.valueOf(ruleGrpList.get(j).toString()));
						RuleGroup ruleGroup=ruleGroupRepository.findOne(Long.valueOf(ruleGrpList.get(j).toString()));
						log.info("ruleGroup :"+ruleGroup);
						ruleGroupWithRulesMap.put("id", ruleGroup.getId());
						if(ruleGroup!=null && ruleGroup.getName()!=null)
							ruleGroupWithRulesMap.put("name", ruleGroup.getName());
						if(ruleGrpDetailsList.size()>0)
						{
							
							log.info("ruleGrpDetailsList.size() :"+ruleGrpDetailsList.size());
							List<HashMap> map=new ArrayList<HashMap>();
							for(RuleGroupDetails ruleGrpDetail:ruleGrpDetailsList)
							{
								log.info("ruleGroup detail:"+ruleGrpDetail);
								//ruleMap.put("id", ruleGroup.getId());
								//ruleMap.put("name", ruleGroup.getName());
								List<Rules> rulesList=new ArrayList<Rules>();

								if(ruleGrpDetail.getRuleId()!=null){
									Rules rules=rulesRepository.findOne(ruleGrpDetail.getRuleId());
									HashMap newRuleMap=new HashMap();
									newRuleMap.put("id", rules.getId());
									if(rules.getRuleCode()!=null && !rules.getRuleCode().isEmpty())
										newRuleMap.put("ruleCode", rules.getRuleCode());
									map.add(newRuleMap);
								}
							}
							log.info("map :"+map);
							ruleGroupWithRulesMap.put("rules", map);
							//ruleMap.put("rules", map);
							log.info("ruleMap :"+ruleMap);
							//FinalMap.add(ruleMap);
							log.info("FinalMap :"+FinalMap);
							ruleGroupsListMap.add(ruleGroupWithRulesMap);
						}
					}
					LookUpCode lKCode=lookUpCodeRepository.findByTenantIdAndLookUpCodeAndLookUpType(tenantId,distinct.get(i).toString(),"RULE_GROUP_TYPE");
					ruleGroupMap.put("rulePurpose", lKCode.getMeaning());
					ruleGroupMap.put("ruleGroups", ruleGroupsListMap);
					ruleGroupMap.put("count", ruleGrpList.size());
					FinalMap.add(ruleGroupMap);

				}

			}


			else
			{
				if(distinct.get(i) != null && !distinct.get(i).toString().isEmpty() && !distinct.get(i).toString().equals(""))
				{
					HashMap map1=new HashMap();
					k=k+1;
					String img="";
					if(distinct.get(i).toString().equalsIgnoreCase("Chase"))
					{
						img=chaseImg;
					}
					else if(distinct.get(i).toString().equalsIgnoreCase("BOA"))
					{
						img=bOAImg;
					}
					else if(distinct.get(i).toString().equalsIgnoreCase("Wellsforgo"))
					{
						img=wellsforgoImg;
					}
					else if(distinct.get(i).toString().equalsIgnoreCase("Citi"))
					{
						img=citiImg;
					}
					else if(distinct.get(i).toString().equalsIgnoreCase("GOOGLE_DRIVE"))
					{
						img=googleDriveImg;
					}
					else if(distinct.get(i).toString().equalsIgnoreCase("DROP_BOX"))
					{
						img=dropBoxImg;
					}
					else if(distinct.get(i).toString().equalsIgnoreCase("SFTP"))
					{
						img=sFTPImg;
					}


					String str=columnName+"='"+distinct.get(i)+"' and tenantId="+tenantId;
					//List entity=em.createQuery("select u FROM "+tableName+" u"+ " where "+str).getResultList();
					List entity=em.createQuery("FROM "+tableName+ " where "+str).getResultList();

					log.info("entity.size() :"+entity.size());
					map1.put("S.no",k);
					map1.put(columnName, distinct.get(i));
					String displayName=distinct.get(i).toString().replaceAll("\\W", " ");
					if(columnName.equalsIgnoreCase("connectionType"))
					{
						String lookUpType="CONNECTION_TYPE";
						LookUpCode meaning=lookUpCodeRepository.findByTenantIdAndLookUpCodeAndLookUpType(tenantId,distinct.get(i).toString(),lookUpType);
						map1.put("dispname", meaning.getMeaning());
					}

					else
						map1.put("dispname", displayName);
					map1.put("imagePath",img);
					map1.put("count",entity.size());
					map1.put("Lists", entity);
					FinalMap.add(map1);
				}
			}

		}
		return FinalMap;
	}






	/**
	 * Author Kiran, Ravali
	 * @param filePath
	 * @return
	 * @throws IOException
	 * To Find the delimiter when file uploaded and to save columns in the file templates lines as per row details of line one in file
	 * @throws JSONException 
	 */
	@PostMapping("/findDelimiterAndFileExtension")
	@Timed
	public FileTemplateDataDTO findDelimiterAndFileExtensionWhenFileUploaded(@RequestParam MultipartFile file, @RequestParam(value = "skipStartRow" , defaultValue = "0") int skipStartRow, @RequestParam(value = "skipEndRow" , defaultValue = "0") 
	int skipEndRow,@RequestParam Long tenantId, @RequestParam(value="templateColumns", required=false) String templateColumns, @RequestParam(value="rowIdentifier", required=false) String rowIdentifier,@RequestParam(value="delimiter", required=false) String delimiter) 
	{
		log.info("====== * Finding Delimiter and file excetion Api, filename:- "+file.getOriginalFilename()+"Delimiter: "+delimiter);
		InputStream inputStream;
		try {
			inputStream = file.getInputStream();
			BufferedReader bfrReader = null;
			try {
				/** Here we are reading the file that is uploaded */
				bfrReader = new BufferedReader(new InputStreamReader(inputStream, "UTF-8"));
			} catch (UnsupportedEncodingException e) {
				e.printStackTrace();
			}
			String givenLine="";
			List<HashMap<Integer, Integer>> occeranceList = new ArrayList<HashMap<Integer,Integer>>(); // to find the delimiter maximum occurrences from 10 lines 
			Set<Integer> keys = new HashSet<Integer>(); // Unique Keys/ delimiters

			int tempValue = 0; // get the count of 10 lines


			if(delimiter!=null && !delimiter.isEmpty())
			{
				log.info("Delimiter: "+delimiter);
				int val=Integer.valueOf(delimiter);
				char charDigit = (char) val;
//				char charDigit = delimiter.charAt(0);
				log.info("Reading the data using Delimiter: "+charDigit);
				FileTemplateDataDTO result=findDelimiterAndFileExtensionService.readingTemplateFileData(charDigit,file,skipStartRow,skipEndRow,tenantId,rowIdentifier);
				if(result!=null)
				{
//					log.info("Result:-> "+result);
					return result;
				}
			}
			else
			{
				if(templateColumns!=null && templateColumns.equalsIgnoreCase("Variable Columns"))
				{
					while((givenLine = bfrReader.readLine()) != null && tempValue <11)
					{
						/**
						 * Below code is for Dfr file to get the delimiter based on the record identifier
						 * */
						
						if(rowIdentifier!=null)
						{
							int rowIL=rowIdentifier.length();
							String dataRow=givenLine.substring(0,rowIL);
							//log.info("Row Identifier in file: "+dataRow+" and given row Identifier: "+rowIdentifier);
							if(dataRow.equalsIgnoreCase(rowIdentifier))
							{
								log.info("Given Line if row identifier is given:->"+givenLine);
								List<Integer> listInt = findDelimiterAndFileExtensionService.toGetIndexNumbers(givenLine); 
								//log.info("listInt:->"+listInt);
								for(int k=0;k<(listInt.size()/2);k++)
								{
									List<Integer> listIntInside=findDelimiterAndFileExtensionService.toGetIndexNumbers(givenLine);
									//log.info("listIntInside:-> "+listIntInside);
									int start =listIntInside.get(0);
									int end = (listIntInside.get(1)+1);

									StringBuffer buf = new StringBuffer(givenLine);
									String afterRemoving = buf.replace(start, end, "").toString(); 
									givenLine = afterRemoving;
								}
								//log.info("After Removing "+givenLine);
								HashMap<Integer, Integer> occerance = findDelimiterAndFileExtensionService.toFindDelimiter(givenLine);
								//log.info("occerance.keySet():"+occerance.keySet());
								//log.info("occerance.size():"+occerance.size());
								if(occerance.size()!=0)
								{
									keys.addAll(occerance.keySet());
									occeranceList.add(occerance);
								}
								tempValue++;
							}
						}
					}
				}
				else{
					while((givenLine = bfrReader.readLine()) != null && tempValue <11)
					{
						log.info("Given Line is:->"+givenLine);
						List<Integer> listInt = findDelimiterAndFileExtensionService.toGetIndexNumbers(givenLine); 
						//log.info("listInt:->"+listInt);
						for(int k=0;k<(listInt.size()/2);k++)
						{
							List<Integer> listIntInside=findDelimiterAndFileExtensionService.toGetIndexNumbers(givenLine);
							//log.info("listIntInside:-> "+listIntInside);
							int start =listIntInside.get(0);
							int end = (listIntInside.get(1)+1);

							StringBuffer buf = new StringBuffer(givenLine);
							String afterRemoving = buf.replace(start, end, "").toString(); 
							givenLine = afterRemoving;
						}
						//log.info("After Removing "+givenLine);
						HashMap<Integer, Integer> occerance = findDelimiterAndFileExtensionService.toFindDelimiter(givenLine);
						//log.info("occerance.keySet():"+occerance.keySet()+" and occerance.size(): "+occerance.size());
						if(occerance.size()!=0)
						{
							keys.addAll(occerance.keySet());
							occeranceList.add(occerance);
						}
						tempValue++;
					}

				}
				log.info("occeranceList:>>"+occeranceList);
				Integer delimiterObatined=findDelimiterAndFileExtensionService.findTheDelimiter(occeranceList, keys);
				log.info("Result(Delimiter Obtained):- "+delimiterObatined);
				log.info("================= Success Found Delimiter ==================");
				/**
				 *  Here we are passing data and saving file template lines based on delimiter that we have got
				 **/
				char charDigit = (char) delimiterObatined.intValue();
				log.info("Reading the data using Delimiter: "+charDigit);
				FileTemplateDataDTO result=findDelimiterAndFileExtensionService.readingTemplateFileData(charDigit,file,skipStartRow,skipEndRow,tenantId,rowIdentifier);
				if(result!=null)
				{
					log.info("Result:-> "+result);
					log.info("Result:-> "+result.getData().size());
					return result;
				}
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		return null;
	}


	// Bkp 9Aug
	/*@PostMapping("/findDelimiterAndFileExtension")
	@Timed
	public FileTemplateDataDTO findDelimiterAndFileExtensionWhenFileUploaded(@RequestParam MultipartFile file, @RequestParam(value = "skipStartRow" , defaultValue = "0") int skipStartRow, @RequestParam(value = "skipEndRow" , defaultValue = "0") int skipEndRow) 
	{
		log.info("Remove Double Quotes And Find Delimiter: "+file.getOriginalFilename());
		InputStream is;
		try {
			is = file.getInputStream();
			BufferedReader br = null;
			try {
				br = new BufferedReader(new InputStreamReader(is, "UTF-8"));
			} catch (UnsupportedEncodingException e) {
				e.printStackTrace();
			}
			String givenLine="";
			List<HashMap<Integer, Integer>> occeranceList = new ArrayList<HashMap<Integer,Integer>>();
			Set<Integer> keys = new HashSet<Integer>();

			for(int i=0; i<skipStartRow; i++)
			{
				br.readLine();
			}

			int tempValue = 0;

			while((givenLine = br.readLine()) != null && tempValue <10)
			{
				log.info("Given Line is:->"+givenLine);
				List<Integer> listInt = findDelimiterAndFileExtensionService.toGetIndexNumbers(givenLine); 
				log.info("listInt:->"+listInt);
				for(int k=0;k<(listInt.size()/2);k++)
				{
					List<Integer> listIntInside=findDelimiterAndFileExtensionService.toGetIndexNumbers(givenLine);
					log.info("listIntInside:-> "+listIntInside);
					int start =listIntInside.get(0);
					int end = (listIntInside.get(1)+1);

					StringBuffer buf = new StringBuffer(givenLine);
					String afterRemoving = buf.replace(start, end, "").toString(); 
					givenLine = afterRemoving;
				}
				log.info("After Removing "+givenLine);
				HashMap<Integer, Integer> occerance = findDelimiterAndFileExtensionService.toFindDelimiter(givenLine);
				log.info("occerance.keySet():"+occerance.keySet());
				log.info("occerance.size():"+occerance.size());
				if(occerance.size()!=0)
				{
					keys.addAll(occerance.keySet());
					occeranceList.add(occerance);
				}
				tempValue++;
			}
			log.info("occeranceList:>>"+occeranceList);
			Integer delimiterObatined=findDelimiterAndFileExtensionService.findTheDelimiter(occeranceList, keys);
			log.info("Result:-"+delimiterObatined);
			log.info("================= Success Found Delimiter ==================");
	 *//**
	 *  Here we are passing data and saving based on delimiter that we have got
	 **//*
			char digit = (char) delimiterObatined.intValue();
			log.info("Reading the data using Delimiter: "+digit);
			FileTemplateDataDTO result=findDelimiterAndFileExtensionService.readingTemplateFileData(digit,file,skipStartRow,skipEndRow);
			if(result!=null)
			{
				return result;
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		return null;
	}
	  */


	@GetMapping("/testView/{tableName}/{tenantId}")
	@Timed
	public Query testView(@PathVariable String tableName, @PathVariable Long tenantId)
	{
		log.info("Rest Request to get distinct source details");

		Query distinctList=em.createQuery(" FROM "+tableName);
		log.info("distinctList: "+distinctList);
		return distinctList;
	}




}
