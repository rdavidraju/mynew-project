<div class="row  leftmargin-20" *ngIf="!ruleCreationInWQ" style="border-bottom: 1px solid #eee;">
	<div class="col-md-6 col-sm-6 col-xs-6" > 
		<h4 style="margin-top: 6px;">
			<b>Rules</b>
		</h4>
	</div>
	<div class="col-md-6 col-sm-6 col-xs-6" *ngIf="ruleGroupService.ruleGroupRulesAndConditions.rules && !isViewOnly ">
		<button md-icon-button class="pull-right  md-36" (click)="addNewRuleObject(ruleGroupService.ruleGroupRulesAndConditions.rules.length,0)" mdTooltip="New Rule">
			<md-icon>add</md-icon>
		</button>
	</div>
</div>
<button md-icon-button class="pull-right color-green" *ngIf="ruleCreationInWQ" (click)="saveAdhocRule()" mdTooltip="Initiate Job with this rule"
 mdTooltipPosition="below" aria-hidden="true">
	<md-icon>save</md-icon>
</button>
<!-- rules Block start -->
<form novalidate #reconForm="ngForm">
	<div class="row sub-heading-content rule-group-reconciliation" style="padding:7px 0px !important" id="hideIconTable">

		<ng-template ngFor let-ruleObj [ngForOf]="ruleGroupService.ruleGroupRulesAndConditions.rules" let-i="index" *ngIf="ruleGroupService.ruleGroupRulesAndConditions.rulePurpose == 'RECONCILIATION'">
			<p-accordion [multiple]="true" class="rule-group-recon">
				<p-accordionTab [selected]="true">
					<p-header>
						<span *ngIf="ruleObj && ruleObj.rule.ruleCode">{{ruleObj.rule.ruleCode}}</span>
						<span *ngIf="!ruleObj.rule.ruleCode">New Rule - {{i+1}}</span>
						
						<!-- <button md-icon-button class="pull-right" style="top:-10px;" (click)="clearRuleObject(i);false" *ngIf="!isViewOnly && !ruleCreationInWQ "
						 id="showIcon">
							<md-icon>clear</md-icon>
						</button> -->
						<i class="fa fa-eraser pull-right" aria-hidden="true" style="margin-top:4px" (click)="clearRuleObject(i);false" *ngIf="!isViewOnly && !ruleCreationInWQ " mdTooltip="Clear rule"
						id="showIcon"></i>
						<button md-icon-button class="pull-right" style="top:-10px;" (click)="deleteRuleObject(i);false" *ngIf="!isViewOnly && !ruleCreationInWQ " mdTooltip="Delete rule"
						 id="showIcon">
							<md-icon>delete</md-icon>
						</button>
						<button md-icon-button class="pull-right  md-36" style="color: black !important" *ngIf="ruleObj.rule.assignmentFlag && isViewOnly">
							<md-icon>check_circle</md-icon>
						</button>
						<button md-icon-button class="pull-right  md-36" style="color: black !important" *ngIf="(!ruleObj.rule.assignmentFlag || ruleObj.rule.assignment == false )&& isViewOnly">
							<md-icon>error</md-icon>
						</button>
					</p-header>
					<div class="accordioncontenet">
						<div class="row" style="display:flex;">

							<div class="col-md-1 col-sm-4">
								<!-- <span class="linetext-input" *ngIf="ruleObj.rule.id">{{ruleObj.rule.ruleTypeMeaning}}</span> -->
								<!-- <md-expansion-panel [expanded]="true" [selected]="true" (opened)="ruleTypePanelOpenState = true" (closed)="ruleTypePanelOpenState = false"
								 *ngIf="!ruleObj.rule.id">
									<md-expansion-panel-header>
										<md-panel-title>
											<b *ngIf="!ruleObj.rule.ruleType"> Type </b>
											<b *ngIf="ruleObj.rule.ruleType"> {{ruleObj.rule.ruleTypeMeaning}}</b>
										</md-panel-title>
									</md-expansion-panel-header> -->
									<div *ngIf="!ruleObj.rule.id">
									<div *ngFor="let ruleType of ruletypeLOVArray[i]" required class="occurnc-circle  occurrance-shadow"  style="width: 35px !important;height:35px !important;" [ngClass]="ruleType.value ? 'occ-active' : ''" [mdTooltip]="ruleType.name" 
									(click)="selectedRuleType(ruleType,i)">
									<span style="font-weight: bold">{{ruleType.code}}</span>
									
								</div>
								</div>
								<div *ngIf="ruleObj.rule.id">
										<div *ngFor="let ruleType of ruletypeLOVArray[i]" required class="occurnc-circle  occurrance-shadow" style="width: 35px !important;height:35px !important;" [ngClass]="ruleType.value ? 'occ-active' : ''" ><span style="font-weight: bold">{{ruleType.code}}</span></div>
									</div>
									<!-- 									
									<md-radio-group [(ngModel)]="ruleObj.rule.ruleType" (change)="selectedRuleType(i)" layout="row" name="ruleType{{i}}" required
									 [ngClass]="{'color-black' :true}" #ruleType{{i}}="ngModel">
										<md-radio-button style="padding-left: 6px !important;" *ngFor="let ruletype of ruletypeLOV" [disabled]="isViewOnly || ruleObj.rule.id"
										 [value]="ruletype.lookUpCode">{{ruletype.meaning}}</md-radio-button>
									</md-radio-group> -->
								<!-- </md-expansion-panel> -->
							</div>


							<div class="col-md-11">
								<div class="row">

									<div class="col-md-2 col-sm-4" *ngIf=" !ruleCreationInWQ && ruleObj.rule.id">
										<md-input-container>
											<input mdInput [(ngModel)]="ruleObj.rule.ruleCode" placeholder="Rule Name" [ngClass]="{'color-black' :true}" [disabled]="true"
											 name="ruleNameDisplay{{i}}" required #ruleNameDisplay{{i}}="ngModel"> </md-input-container>


										<md-input-container *ngIf="ruleCreationInWQ">
											<input mdInput [(ngModel)]="ruleObj.rule.ruleCode" placeholder="Rule Name" name="ruleNameForWQ" required #name="ngModel"> </md-input-container>

									</div>
									<div class="col-md-2 col-sm-6" *ngIf="!ruleCreationInWQ && ruleListformArray && ruleListformArray[i] && !ruleObj.rule.id">

										<form class="form-horizontal" [style.width]="'100%'" [formGroup]="ruleListformArray[i]">
											<md-input-container>
												<input formControlName="data" mdInput placeholder="Rule Name " auto-complete [(ngModel)]="ruleObj.rule.ruleCode" [source]="ruleListArrays[i]"
												 [list-formatter]="autocompleListFormatter" value-property-name="id" required display-property-name="ruleCode" (keydown)="restrictTab($event.keyCode)"
												 (ngModelChange)="checkIfRuleCodeisUndefined(i)" (blur)= "checkIfBlurCalled(i,ruleObj.rule.ruleCode)" (valueChanged)="setRuleObject($event,i,ruleListformArray[i].value)"
												/>
											</md-input-container>
										</form>


									</div>
									<div class="col-md-2 col-sm-4">

										<md-form-field>
											<input mdInput [mdDatepicker]="stpicker" placeholder="From" [ngClass]="{'color-black' : isViewOnly || ruleObj.rule.ruleGroupAssignId || ruleObj.rule.id }"
											 [disabled]="isViewOnly || ruleObj.rule.ruleGroupAssignId || ruleObj.rule.id" [min]="today" (dateChange)="ruleGroupService.ruleGroupRulesAndConditions.rules[i].rule.startDateChange=true;startDateChanged(ruleObj.rule.startDate,i);" [(ngModel)]="ruleObj.rule.startDate"
											 name="rulestartDate{{i}}" #rulestartDate{{i}}="ngModel" required>
											<md-datepicker-toggle mdSuffix [for]="stpicker" *ngIf="!isViewOnly && !ruleObj.rule.id "></md-datepicker-toggle>
											<md-datepicker #stpicker></md-datepicker>
										</md-form-field>
										<!-- <md-form-field *ngIf="ruleObj.rule.endDate">
											<input mdInput [mdDatepicker]="stpicker" placeholder="From" [ngClass]="{'color-black' : isViewOnly || ruleObj.rule.ruleGroupAssignId || ruleObj.rule.id }"
											 [disabled]="isViewOnly || ruleObj.rule.ruleGroupAssignId || ruleObj.rule.id" [(ngModel)]="ruleObj.rule.startDate"
											 name="rulestartDate{{i}}" #rulestartDate{{i}}="ngModel" required [max]="ruleObj.rule.endDate">
											<md-datepicker-toggle mdSuffix [for]="stpicker" *ngIf="!isViewOnly && !ruleObj.rule.id"></md-datepicker-toggle>
											<md-datepicker #stpicker></md-datepicker>
										</md-form-field> -->
									</div>
									<div class="col-md-2 col-sm-4" >
										<!--*ngIf="(isCreateNew &&  ruleObj.rule.startDate  ) || (isViewOnly && ruleObj.rule.endDate) "!-->
										<md-form-field>
											<input mdInput [mdDatepicker]="edpicker" placeholder="To" [min]="ruleObj.rule.startDate" (dateChange)="ruleGroupService.ruleGroupRulesAndConditions.rules[i].rule.endDateChange=true"[ngClass]="{'color-black' : isViewOnly || ruleObj.rule.ruleGroupAssignId || ruleObj.rule.id}"
											 [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId  || ruleObj.rule.id" [(ngModel)]="ruleObj.rule.endDate"
											 name="ruleendDate{{i}}" #ruleendDate{{i}}="ngModel">
											<md-datepicker-toggle mdSuffix [for]="edpicker" *ngIf="!isViewOnly && !ruleObj.rule.id "></md-datepicker-toggle>
											<md-datepicker #edpicker></md-datepicker>
										</md-form-field>
									</div>
									<div class="col-md-3 col-sm-4 multiselect-text-overflow">

										<md-input-container *ngIf="ruleCreationInWQ">
											<input mdInput [(ngModel)]="ruleGroupService.sourceDataView" placeholder="Reconciliation for" [ngClass]="{'color-black' : true }"
											 [disabled]="true" name="srcDvName{{i}}" required #srcDvName{{i}}="ngModel"> </md-input-container>



										<md-input-container *ngIf="(ruleObj.rule.id ) && !ruleCreationInWQ">
											<input mdInput [(ngModel)]="ruleObj.rule.sDataViewDisplayName" placeholder="Source DataView" [ngClass]="{'color-black' : isViewOnly || ruleObj.rule.ruleGroupAssignId  || ruleObj.rule.id}"
											 [disabled]="true" name="srcDvName{{i}}" required #srcDvName{{i}}="ngModel"> </md-input-container>

										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="font-size: 12px;color: rgba(0,0,0,.54);padding-bottom: 3px;" *ngIf="!ruleCreationInWQ && (!ruleObj.rule.id ) && ruleObj.rule.sourceDVId && ruleObj.rule.sourceDVId.length>0">
											Reconciliation for :</div>
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="font-size: 12px;color: rgba(0,0,0,.54);padding-bottom: 3px;"*ngIf="!ruleCreationInWQ && (!ruleObj.rule.id ) && !ruleObj.rule.sourceDVId || (ruleObj.rule.sourceDVId && ruleObj.rule.sourceDVId.length==0)">
											Reconciliation for :</div>
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top: -5px;">
											<angular2-multiselect [data]="sourceDataViewsAndColumns" [(ngModel)]="ruleObj.rule.sourceDVId" [settings]="sourceDropdownSettings" required
											 (onSelect)="fetchSrcColumns($event,i)" (onDeSelect)="clearSourceDV(i)" name="sdv{{i}}" #sdv{{i}}="ngModel"
											 *ngIf="!ruleCreationInWQ && (!ruleObj.rule.id ) && sourceDataViewsAndColumns && sourceDataViewsAndColumns.length>0">
											</angular2-multiselect>
											<span class="cuppa-single-selection-underline" *ngIf="!ruleCreationInWQ && (!ruleObj.rule.id ) && sourceDataViewsAndColumns && sourceDataViewsAndColumns.length>0"></span>
										</div>

									</div>
									<div class="col-md-3 col-sm-4">

										<md-input-container *ngIf="ruleCreationInWQ">
											<input mdInput [(ngModel)]="ruleGroupService.targetDataView" placeholder="Target DataView" [ngClass]="{'color-black' : true }"
											 [disabled]="true" name="targetDvName{{i}}" required #targetDvName{{i}}="ngModel"> </md-input-container>


										<md-input-container *ngIf=" !ruleCreationInWQ && ruleObj.rule.id">
											<input mdInput [(ngModel)]="ruleObj.rule.tDataViewDisplayName" placeholder="Target DataView" [ngClass]="{'color-black' : isViewOnly || ruleObj.rule.ruleGroupAssignId || ruleObj.rule.id}"
											 [disabled]="true" name="targetDvName{{i}}" required #targetDvName{{i}}="ngModel"> </md-input-container>

										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="font-size: 12px;color: rgba(0,0,0,.54);padding-bottom: 3px;" *ngIf="!ruleCreationInWQ && (!ruleObj.rule.id ) && ruleObj.rule.targetDVId && ruleObj.rule.targetDVId.length>0">
											Reconciliation with :</div>
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="font-size: 12px;color: rgba(0,0,0,.54);padding-bottom: 3px;" *ngIf="!ruleCreationInWQ && (!ruleObj.rule.id ) &&  !ruleObj.rule.targetDVId || (ruleObj.rule.sourceDVId && ruleObj.rule.targetDVId.length==0)">
											Reconciliation with :</div>
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top: -5px;">
											<angular2-multiselect [data]="sourceDataViewsAndColumns" required [(ngModel)]="ruleObj.rule.targetDVId" [settings]="targetDropdownSettings"
											 (onSelect)="fetchTargetColumns($event,i)" (onDeSelect)="clearTargetDV(i)" *ngIf=" !ruleCreationInWQ &&  !ruleObj.rule.id && sourceDataViewsAndColumns && sourceDataViewsAndColumns.length>0"
											 name="targetDataViewSelect{{i}}" #dv{{i}}="ngModel">
											</angular2-multiselect>
											<span class="cuppa-single-selection-underline" *ngIf=" !ruleCreationInWQ &&  !ruleObj.rule.id && sourceDataViewsAndColumns && sourceDataViewsAndColumns.length>0"></span>
										</div>
									<div class="pull-right"  style="top:25px;" >
										<md-slide-toggle color="primary" placeholder="status" [(ngModel)]="ruleObj.rule.assignmentFlag" name="status{{i}}"
										#status{{i}}="ngModel" *ngIf="isEdit && ruleObj.rule.ruleGroupAssignId"> </md-slide-toggle>
									</div>
									</div>
									

								</div>
								<div class="row" style="margin-left: 7px;">
									<!-- <div class="col-md-12"> -->
										<p-accordionTab header="" [selected]="true" *ngIf="( !ruleCreationInWQ && (((!isViewOnly && !ruleObj.rule.id )&& ruleObj.rule.targetDVId && ruleObj.rule.sourceDVId) || ((isViewOnly || ruleObj.rule.id) && ruleObj.rule.sDataViewDisplayName && ruleObj.rule.tDataViewDisplayName) )) || (ruleCreationInWQ && ( ruleGroupService.targetDataView && ruleGroupService.sourceDataView ))">
											<p-header>
												<span>Rule Conditions</span>
											</p-header>
											<div class="accordioncontenet rule-conditions-view table-responsive">
												<table class="table">
													<thead class="tableheader text-nowrap">
														<tr>
															<th>Sequence</th>
															<th>Source Column</th>
															<th style="width:50px;"></th>
															<th>Operator</th>
															<th>Target Column</th>
															<th style="width:50px;"></th>
															<th  style="width: 9%;">Logical Operator</th>
															<th *ngIf="!isViewOnly && !ruleObj.rule.id"></th>
														</tr>
													</thead>
													<tbody class="text-nowrap">
														<tr *ngFor="let condition of ruleObj.ruleConditions;let childIndex=index" (mouseover)="mouseOverRowNo = childIndex">
															<td>
																<span style="top: 24px" class="linetext-input" *ngIf="!ruleObj.rule.ruleGroupAssignId ">{{childIndex+1}}</span>

																<span class="linetext-input" *ngIf="ruleObj.rule.ruleGroupAssignId">{{childIndex+1}}</span>
															</td>
															<td>
																<md-select class="md-no-placeholder" [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedSourceColumn(i,childIndex,condition.sColumnId)"
																 [(ngModel)]="condition.sColumnId" required name="sColumn{{i}}{{childIndex}}" #sColumn{{i}}{{childIndex}}="ngModel"
																 *ngIf="!isViewOnly  && !ruleObj.rule.id && (!ruleObj.rule.ruleGroupAssignId ) && ruleObj.ruleConditions && ruleObj.ruleConditions.length == 1">
																	<md-option size="50" *ngFor="let sourceCol of sourceColumnLOV[i]" [value]="sourceCol.id">{{sourceCol.columnName}}</md-option>
																	<md-option [value]=""></md-option>
																</md-select>
																<md-select class="md-no-placeholder" [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedSourceColumn(i,childIndex,condition.sColumnId)"
																 [(ngModel)]="condition.sColumnId" name="sColumn{{i}}{{childIndex}}" #sColumn{{i}}{{childIndex}}="ngModel"
																 *ngIf="!isViewOnly && !ruleObj.rule.id && (!ruleObj.rule.ruleGroupAssignId ) && ruleObj.ruleConditions && ruleObj.ruleConditions.length > 1 ">
																	<md-option size="50" *ngFor="let sourceCol of sourceColumnLOV[i]" [value]="sourceCol.id">{{sourceCol.columnName}}</md-option>
																	<md-option [value]=""></md-option>
																</md-select>
																<span class="linetext-input" *ngIf="isViewOnly ||  (ruleObj.rule.ruleGroupAssignId) || ruleObj.rule.id">{{condition.sColumnName}}</span>
															</td>
															<td style="width:50px;">
																<!-- <button md-icon-button [popover]="srcFilterPopover" *ngIf="!isViewOnly && mouseOverRowNo == childIndex && (!ruleObj.rule.ruleGroupAssignId ) && !ruleObj.rule.id"
																 mdTooltip="Add Filters">
																	<md-icon>more_vert</md-icon>
																</button> -->
																<button md-icon-button *ngIf="!isViewOnly && mouseOverRowNo == childIndex && (!ruleObj.rule.ruleGroupAssignId ) && !ruleObj.rule.id" (click)="openSrcFilters(i,childIndex)"
																mdTooltip="Add Filters">
																   <md-icon>more_vert</md-icon>
															   </button>
																<!-- display source additional filter tagged -->
																<i class="fa fa-filter hand" aria-hidden="true" popoverTitle="Filter" popoverPlacement="right" [popoverOnHover]="true" [popoverCloseOnMouseOutside]="true"
																 popover="{{condition.sColumnName + ' ' + condition.sOperator + ' ' + condition.sValue}} " *ngIf="condition.sOperator">
																</i>
																<i class="hand" style="color: black; font-style: italic; font-family: cursive; font-weight: normal; font-size: 15px; visibility: visible;"
																 popoverTitle="Expression" popoverPlacement="right" [popoverOnHover]="true" [popoverCloseOnMouseOutside]="true"
																 popover="{{condition.sFormula}} " *ngIf="condition.sFormula">
																	<b>fx</b>
																</i>
																<i class="hand" style="color: black; font-style: italic; font-family: cursive; font-weight: normal; font-size: 15px; visibility: visible;"
																 popoverTitle="Tolerance" popoverPlacement="right" [popoverOnHover]="true" [popoverCloseOnMouseOutside]="true"
																 popover="{{condition.sToleranceTypeMeaning+' : '+ condition.sToleranceValueFrom+ ' to '+condition.sToleranceValueTo}} "
																 *ngIf="condition.sToleranceValueFrom">
																	<b>T</b>
																</i>
																<!-- End -->

																<popover-content #srcFilterPopover placement="right" [animation]="true" [closeOnClickOutside]="false" style="z-index: 999 !important;width:40px"
																 [popoverCloseOnMouseOutside]="false">
																	<div class="row">

																		<div class="display-PopOverActions col-md-12">
																			<ul>
																				<li [class.highlight_stay]="filterAction=='srcFilter'">
																					<a class="hand " mdTooltip="Add Filter" (click)="addFilter(i,childIndex);filterAction='srcFilter' ">
																						<i class="fa fa-filter"></i>
																					</a>
																				</li>
																				<li [class.highlight_stay]="filterAction=='srcFormula'">
																					<a class="hand " mdTooltip="Add Formula" (click)="addFormula(i,childIndex);filterAction='srcFormula'">
																						<b>fx</b>
																					</a>
																				</li>
																				<li [class.highlight_stay]="filterAction=='srcTolerance'">
																					<a class="hand " mdTooltip="Add Tolerance" (click)="addTolerance(i,childIndex);filterAction='srcTolerance'">
																						<b>T</b>
																					</a>
																				</li>
																			</ul>
																		</div>

																		<div class="col-md-10" *ngIf="(sFilter && sFilter[i] && sFilter[i][childIndex]) ||( sFormula && sFormula[i] && sFormula[i][childIndex])	|| (sTolerance && sTolerance[i] && sTolerance[i][childIndex])">
																			
														<button md-icon-button class="pull-right" mdTooltip="Close"  [disabled]="!recFiltersForm.valid" (click)="closeSrc(i,childIndex);srcFilterPopover.hide();" >
															<md-icon>clear</md-icon>
													 	</button>
														<!-- <i class="pull-right fa fa-times hand" aria-hidden="true" [disabled]="!recFiltersForm.valid" mdTooltip="Close"  (click)="closeSrc(i,childIndex);srcFilterPopover.hide();"></i> -->
																			<form novalidate #recFiltersForm="ngForm">
																			<div *ngIf=" sFilter && sFilter[i] && sFilter[i][childIndex]">
																				<table>
																					<thead class="text-nowrap">
																						<tr>
																							<th>Operator</th>
																							<th>Value</th>
																						</tr>
																					</thead>
																					<tbody class="text-nowrap">
																						<tr>
																							<td>
																								<md-select (change)="selectOperator();srcFilterPopover.show();" [(ngModel)]="condition.sOperator" name="sOperator{{i}}{{childIndex}}" class="md-no-placeholder"
																								 #sOperator{{i}}{{childIndex}}="ngModel">
																									<md-option size="50" *ngFor="let operator of operatorList" [value]="operator.lookUpCode">{{operator.meaning}}</md-option>
																								</md-select>
																							</td>
																							<td>
																								<md-input-container class="example-full-width">
																									<input mdInput [(ngModel)]="condition.sValue" name="value{{i}}{{childIndex}}" required #value{{i}}{{childIndex}}="ngModel"> </md-input-container>
																							</td>
																						</tr>

																					</tbody>
																				</table>
																				<button md-icon-button class="pull-right color-green ripple" [disabled]="!recFiltersForm.valid"  aria-hidden="true"  [disabled]="!recFiltersForm.valid"  (click)="savesrcFilter(i,childIndex);srcFilterPopover.hide();"
																				 mdTooltip="Save">
																					<md-icon>done</md-icon>
																				</button>
																				<button md-icon-button class="pull-right color-red ripple" aria-hidden="true" (click)="cancelsrcFilter(i,childIndex)" mdTooltip="Clear">
																					<md-icon>delete</md-icon>
																				</button>
																			</div>
																			<div *ngIf="sFormula && sFormula[i] && sFormula[i][childIndex]">
																				<div>
																					<label class="control-label" style="font-size: 16px;">Select Function:
																					</label>
																					<md-select [(ngModel)]="condition.isSFormula" style="width:230px;z-index: 100 !important;" [ngClass]="{'color-black' : isViewOnly}"
																					 name="excelexpression{{i}}{{childIndex}}" #excelexpression{{i}}{{childIndex}}="ngModel">
																						<md-option *ngFor="let excelexpression of excelFunctions" [value]="excelexpression.lookUpCode" (click)="showExcelFunction(excelexpression.lookUpCode, i,childIndex,excelexpression.description);srcFilterPopover.show()">
																							{{ excelexpression.meaning }} </md-option>
																					</md-select>
																				</div>
																				<div *ngIf="condition.isSFormula" class="data-view-query-build">
																					<textarea mdInput [(ngModel)]="condition.sFormula" name="sFormula{{i}}{{childIndex}}"  required mdTooltip=""></textarea>
																				</div>

																				<div *ngIf="condition.isSFormula" style="padding-top: 10px;">
																					<span>Eg: {{condition.sFormulaExpressionExample}}</span>
																					<button md-icon-button class="pull-right color-green ripple" [disabled]="!recFiltersForm.valid"  aria-hidden="true" (click)="savesrcExpression(condition.sFormula,i,childIndex);srcFilterPopover.hide();"
																					 mdTooltip="Save">
																						<md-icon>done</md-icon>
																					</button>
																					<button md-icon-button class="pull-right color-red ripple" aria-hidden="true" (click)="cancelsrcFormula(i,childIndex)" mdTooltip="Clear">
																						<md-icon>delete</md-icon>
																					</button>
																				</div>
																			</div>
																			<div class="table-responsive" *ngIf="sTolerance && sTolerance[i] && sTolerance[i][childIndex]">
																				<table>
																					<thead class="text-nowrap">
																						<tr>
																							<th>Type</th>
																							<th>Range</th>
																							<th></th>
																						</tr>
																					</thead>
																					<tbody class="text-nowrap">
																						<tr>
																							<td>
																								<md-select placeholder="Type" class="example-full-width" #ruleType [(ngModel)]="condition.sToleranceType" name="stoleranceType{{i}}{{childIndex}}"
																								 required #stoleranceType{{i}{{childIndex}}="ngModel">
																									<md-option *ngFor="let toleranceType of toleranceTypeLOV" [value]="toleranceType.lookUpCode"> {{ toleranceType.meaning}} </md-option>
																								</md-select>
																							</td>
																							<td style="display: inline-flex;">
																								<md-input-container class="example-full-width">
																									<input mdInput [(ngModel)]="condition.sToleranceValueFrom" (blur)="splitsToleranceFrom(i,childIndex)" placeholder="From"
																									 name="sFromValue{{i}}{{childIndex}}" required #sFromValue{{i}}{{childIndex}}="ngModel"> </md-input-container>
																							</td>
																							<td>
																								<md-input-container class="example-full-width ">

																									<input mdInput [(ngModel)]="condition.sToleranceValueTo" (blur)="splitsToleranceTo(i,childIndex)" placeholder="To" name="sToValue{{i}}{{childIndex}}"
																									 required #sToValue{{i}}{{childIndex}}="ngModel"> </md-input-container>
																							</td>
																						</tr>
																					</tbody>
																				</table>
																				<button md-icon-button class="pull-right color-green ripple" [disabled]="!recFiltersForm.valid"  aria-hidden="true" (click)="savesrcTolerance(i,childIndex);srcFilterPopover.hide()"
																				 mdTooltip="Save">
																					<md-icon>done</md-icon>
																				</button>
																				<button md-icon-button class="pull-right color-red ripple" aria-hidden="true" (click)="cancelsrcTolerance(i,childIndex)"
																				 mdTooltip="Clear">
																					<md-icon>delete</md-icon>
																				</button>
																			</div>
																		</form>
																		</div>
																	</div>
																</popover-content>
															</td>
															<td>
																<md-select class="md-no-placeholder" [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedOperator()" [(ngModel)]="condition.operator"
																 name="operator{{i}}{{childIndex}}" #operator{{i}}{{childIndex}}="ngModel" required *ngIf="!isViewOnly && !ruleObj.rule.id && (!ruleObj.rule.ruleGroupAssignId) && operatorBasedOnColumnLOV[i] && operatorBasedOnColumnLOV[i][childIndex] && ruleObj.ruleConditions && ruleObj.ruleConditions.length == 1">
																	<md-option size="50" *ngFor="let operator of operatorBasedOnColumnLOV[i][childIndex]" [value]="operator.lookUpCode">{{operator.meaning}}</md-option>
																	<md-option [value]=""></md-option>
																</md-select>

																<md-select class="md-no-placeholder" [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedOperator()" [(ngModel)]="condition.operator"
																 name="operator{{i}}{{childIndex}}" #operator{{i}}{{childIndex}}="ngModel" *ngIf="!isViewOnly && !ruleObj.rule.id && (!ruleObj.rule.ruleGroupAssignId) && operatorBasedOnColumnLOV[i] && operatorBasedOnColumnLOV[i][childIndex] && ruleObj.ruleConditions && ruleObj.ruleConditions.length > 1">
																	<md-option size="50" *ngFor="let operator of operatorBasedOnColumnLOV[i][childIndex]" [value]="operator.lookUpCode">{{operator.meaning}}</md-option>
																	<md-option [value]=""></md-option>
																</md-select>

																<span class="linetext-input" *ngIf="isViewOnly || ( ruleObj.rule.ruleGroupAssignId) || ruleObj.rule.id">{{condition.operatorMeaning}}</span>
															</td>

															<td>
																<md-select class="md-no-placeholder" [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedTargetColumn(i,childIndex,condition.tColumnId)"
																 [(ngModel)]="condition.tColumnId" name="tColumn{{i}}{{childIndex}}" #tColumn{{i}}{{childIndex}}="ngModel"
																 required *ngIf="!isViewOnly && !ruleObj.rule.id  && (!ruleObj.rule.ruleGroupAssignId ) && ruleObj.ruleConditions && ruleObj.ruleConditions.length == 1">
																	<md-option size="50" *ngFor="let targetCol of targetColumnLOV[i]" [value]="targetCol.id">{{targetCol.columnName}}</md-option>
																	<md-option [value]=""></md-option>
																</md-select>

																<md-select class="md-no-placeholder" [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedTargetColumn(i,childIndex,condition.tColumnId)"
																 [(ngModel)]="condition.tColumnId" name="tColumn{{i}}{{childIndex}}" #tColumn{{i}}{{childIndex}}="ngModel"
																 *ngIf="!isViewOnly && !ruleObj.rule.id && (!ruleObj.rule.ruleGroupAssignId ) && ruleObj.ruleConditions && ruleObj.ruleConditions.length > 1">
																	<md-option size="50" *ngFor="let targetCol of targetColumnLOV[i]" [value]="targetCol.id">{{targetCol.columnName}}</md-option>
																	<md-option [value]=""></md-option>
																</md-select>

																<span class="linetext-input" *ngIf="isViewOnly || ( ruleObj.rule.ruleGroupAssignId) || ruleObj.rule.id">{{condition.tColumnName}}</span>
															</td>
															<td style="width:50px;">
																<button md-icon-button (click)="openTargetFilters(i,childIndex)" *ngIf="!isViewOnly && mouseOverRowNo == childIndex && (!ruleObj.rule.ruleGroupAssignId) && !ruleObj.rule.id"
																 mdTooltip="Add Filters">
																	<md-icon>more_vert</md-icon>
																</button>
																<!-- display Target additional filter tagged -->
																<i class="fa fa-filter hand" aria-hidden="true" popoverTitle="Filter" popoverPlacement="right" [popoverOnHover]="true" [popoverCloseOnMouseOutside]="true"
																 popover="{{condition.tColumnName + ' ' + condition.tOperator + ' ' + condition.tValue}} " *ngIf="condition.tOperator">
																</i>
																<i class="hand" style="color: black; font-style: italic; font-family: cursive; font-weight: normal; font-size: 15px; visibility: visible;"
																  popoverTitle="Formula" popoverPlacement="right" [popoverOnHover]="true" [popoverCloseOnMouseOutside]="true"
																 popover="{{condition.tFormula}} " *ngIf="condition.tFormula">
																	<b>fx</b>
																</i>
																<i class="hand" style="color: black; font-style: italic; font-family: cursive; font-weight: normal; font-size: 15px; visibility: visible;"
																 popoverTitle="Tolerance" popoverPlacement="right" [popoverOnHover]="true" [popoverCloseOnMouseOutside]="true"
																 popover="{{condition.tToleranceTypeMeaning+' : '+ condition.tToleranceValueFrom+' to '+condition.tToleranceValueTo}} "
																 *ngIf="condition.tToleranceValueFrom">
																	<b>T</b>
																</i>
																<!-- End -->
																<popover-content #targetFilterPopover placement="right" [animation]="true" [closeOnClickOutside]="false" style="z-index: 999 !important;"
																 [popoverCloseOnMouseOutside]="false">
																	<div class="row">
																		<div class="display-PopOverActions col-md-12">
																			<ul>
																				<li [class.highlight_stay]="filterAction=='targetFilter'">
																					<a class="hand" mdTooltip="Add Filter" (click)="addtFilter(i,childIndex);filterAction='targetFilter' ">
																						<i class="fa fa-filter"></i>
																					</a>
																				</li>
																				<li [class.highlight_stay]="filterAction=='targetFormula'">
																					<a class="hand" mdTooltip="Add Formula" (click)="addtFormula(i,childIndex);filterAction='targetFormula' ">
																						<b>fx</b>
																					</a>
																				</li>
																				<li [class.highlight_stay]="filterAction=='targetTolerance'">
																					<a class="hand" mdTooltip="Add Tolerance" (click)="addtTolerance(i,childIndex);filterAction='targetTolerance' ">
																						<b>T</b>
																					</a>
																				</li>
																			</ul>
																		</div>


																		<div class="col-md-10">
																			<i class="pull-right fa fa-times hand" aria-hidden="true" mdTooltip="Close" (click)="closeTarget(i,childIndex);targetFilterPopover.hide();"
																			 *ngIf="(tFilter && tFilter[i] && tFilter[i][childIndex])|| 	(tFormula && tFormula[i] && tFormula[i][childIndex])|| (tTolerance && tTolerance[i] && tTolerance[i][childIndex])">
																			</i>
																			<div *ngIf="tFilter && tFilter[i] && tFilter[i][childIndex]">
																				<table>
																					<thead class="text-nowrap">
																						<tr>
																							<th>Operator</th>
																							<th>Value</th>
																						</tr>
																					</thead>
																					<tbody class="text-nowrap">
																						<tr>
																							<td>
																								<md-select (change)="selecttOperator();targetFilterPopover.show();" [(ngModel)]="condition.tOperator" name="tOperator{{i}}{{childIndex}}"
																								 #tOperator{{i}}{{childIndex}}="ngModel">
																									<md-option size="50" *ngFor="let operator of operatorList" [value]="operator.lookUpCode">{{operator.meaning}}</md-option>
																								</md-select>
																							</td>
																							<td>
																								<md-input-container class="example-full-width ">
																									<input mdInput [(ngModel)]="condition.tValue" name="valuee{{i}}{{childIndex}}" required #valuee{{i}}{{childIndex}}="ngModel"> </md-input-container>
																							</td>
																						</tr>
																					</tbody>
																				</table>
																				<button md-icon-button class="pull-right color-green ripple" aria-hidden="true" (click)="savetargetFilter(i, childIndex);targetFilterPopover.hide();"
																				 mdTooltip="Save">
																					<md-icon>done</md-icon>
																				</button>
																				<button md-icon-button class="pull-right color-red ripple" aria-hidden="true" (click)="cancelTargetFilter(i,childIndex)"
																				 mdTooltip="Clear">
																					<md-icon>delete</md-icon>
																				</button>
																			</div>

																			<div *ngIf="tFormula && tFormula[i] && tFormula[i][childIndex]">
																				<div>
																					<label class="control-label" style="font-size: 16px;">Select Function:
																					</label>
																					<md-select [(ngModel)]="condition.isTFormula" style="width:230px;z-index: 100 !important;" [ngClass]="{'color-black' : isViewOnly}"
																					 name="excelexpression{{i}}{{childIndex}}" #excelexpression{{i}}{{childIndex}}="ngModel">
																						<md-option *ngFor="let excelexpression of excelFunctions" [value]="excelexpression.lookUpCode" (click)="showExcelFunction(excelexpression.lookUpCode, i,childIndex,excelexpression.description);srcFilterPopover.show()">
																							{{ excelexpression.meaning }} </md-option>
																					</md-select>
																				</div>
																				<div *ngIf="condition.isTFormula" class="data-view-query-build">
																					<textarea mdInput [(ngModel)]="condition.tFormula" name="sFormula{{i}}{{childIndex}}" mdTooltip=""></textarea>
																				</div>

																				<div *ngIf="condition.isTFormula" style="padding-top: 10px;">
																					<span>Eg: {{condition.sFormulaExpressionExample}}</span>
																					<button md-icon-button class="pull-right color-green ripple" aria-hidden="true" (click)="savetargetExpression(condition.tFormula,i, childIndex);targetFilterPopover.hide();"
																					 mdTooltip="Save">
																						<md-icon>done</md-icon>
																					</button>
																					<button md-icon-button class="pull-right color-red ripple" aria-hidden="true" (click)="canceltargetFormula(i,childIndex)"
																					 mdTooltip="Clear">
																						<md-icon>delete</md-icon>
																					</button>
																				</div>
																			</div>
																			<div class="table-responsive" *ngIf="tTolerance && tTolerance[i] && tTolerance[i][childIndex]">
																				<table>
																					<thead class="text-nowrap">
																						<tr>
																							<th>Type</th>
																							<th>Range</th>
																						</tr>
																					</thead>
																					<tbody class="text-nowrap">
																						<tr>
																							<td>
																								<md-select placeholder="Type" class="example-full-width " #ruleType [(ngModel)]="condition.tToleranceType" name="toleranceType{{i}}{{childIndex}}"
																								 required #toleranceType{{i}{{childIndex}}="ngModel">
																									<md-option *ngFor="let toleranceType of toleranceTypeLOV" [value]="toleranceType.lookUpCode"> {{ toleranceType.meaning}} </md-option>
																								</md-select>
																							</td>
																							<td style="display: inline-flex;">
																								<md-input-container class="example-full-width">
																									<input mdInput [(ngModel)]="condition.tToleranceValueFrom" (blur)="splittToleranceFrom(i,childIndex)" placeholder="From"
																									 name="tFromValue{{i}}{{childIndex}}" required #tFromValue{{i}}{{childIndex}}="ngModel"> </md-input-container>
																								<md-input-container class="example-full-width ">
																									<input mdInput [(ngModel)]="condition.tToleranceValueTo" (blur)="splittToleranceTo(i,childIndex)" placeholder="To" name="tToValue{{i}}{{childIndex}}"
																									 required #tToValue{{i}}{{childIndex}}="ngModel"> </md-input-container>
																							</td>
																						</tr>
																					</tbody>
																				</table>
																				<button md-icon-button class="pull-right color-green ripple" aria-hidden="true" (click)="savetargetTolerance(i,childIndex);targetFilterPopover.hide()"
																				 mdTooltip="Save">
																					<md-icon>done</md-icon>
																				</button>
																				<button md-icon-button class="pull-right color-red ripple" aria-hidden="true" (click)="canceltargetTolerance(i,childIndex)"
																				 mdTooltip="Clear">
																					<md-icon>delete</md-icon>
																				</button>
																			</div>
																		</div>
																	</div>

																</popover-content>
															</td>
															<td style="width: 9%;">
																<span class="linetext-input" *ngIf="ruleObj.rule.id">{{condition.logicalOperatorMeaning}}</span>
																<div class="display-flex " *ngIf="!ruleObj.rule.id && logicalOpLOVArray && logicalOpLOVArray[i] && logicalOpLOVArray[i][childIndex]" >

																		<div *ngFor="let lOperator of logicalOpLOVArray[i][childIndex]" class="occurnc-circle occurrance-shadow" [ngClass]="lOperator.value ? 'occ-active' : ''" [mdTooltip]="lOperator.name" (click)="selectedLogicalOperator(lOperator,i,childIndex);">
																				<span style="font-weight: bold">{{lOperator.code}}</span>
																			
																		</div>
																		</div>
<!-- 
																	<md-radio-group [(ngModel)]="condition.logicalOperator" (change)="selectedLogicalOperator();addNewCondition(i,childIndex+1)"
																	 layout="row" name="lOperator{{i}}{{childIndex}}" #lOperator{{i}}{{childIndex}}="ngModel" *ngIf="!ruleObj.rule.id">
																		<md-radio-button style="padding-left: 6px !important;" *ngFor="let lOperator of logicalOperatorLOV" [value]="lOperator.lookUpCode">{{lOperator.meaning}}</md-radio-button>
																	</md-radio-group> -->
																<!-- </div> -->

																<!-- 
														<md-select [disabled]="isViewOnly  || ruleObj.rule.ruleGroupAssignId" (change)="selectedLogicalOperator();addNewCondition(i,childIndex+1)" [(ngModel)]="condition.logicalOperator"
														name="lOperator{{i}}{	{childIndex}}" #lOperator{{i}}{{childIndex}}="ngModel" *ngIf="!isViewOnly && (!ruleObj.rule.ruleGroupAssignId)">
															<md-option size="50" *ngFor="let lOperator of logicalOperatorLOV" [value]="lOperator.lookUpCode">{{lOperator.meaning}}</md-option>
														</md-select>												-->
																<!-- <span class="linetext-input" *ngIf="isViewOnly || ( ruleObj.rule.ruleGroupAssignId) || ruleObj.rule.id">{{condition.logicalOperatorMeaning}}</span> -->
															</td>
															<td style="width: 150px;" *ngIf="!isViewOnly && !ruleObj.rule.id">
																<div class="display-flex">
																	<div *ngIf="!isViewOnly && (!ruleObj.rule.ruleGroupAssignId) && !ruleObj.rule.id && mouseOverRowNo == childIndex && !ruleObj.rule.ruleGroupAssignId"
																	 style="color: red; font-style: italic; font-family: cursive; font-weight: normal; font-size: 20px;">
																		<button md-icon-button class="color-dark-red pull-right" mdTooltip="Delete" (click)="deleteCondition(i,childIndex)">
																			<md-icon>delete</md-icon>
																		</button>
																	</div>
																	<!-- <div *ngIf="childIndex == ruleObj.ruleConditions.length-1 && condition.logicalOperator && (!ruleObj.rule.ruleGroupAssignId ) && !ruleObj.rule.ruleGroupAssignId"
															style="color: green; font-style: italic; font-family: cursive; font-weight: normal; font-size: 20px;">
																<button md-icon-button class="color-yellow-green pull-right" mdTooltip="Add New Condition" (click)="addNewCondition(i,childIndex+1)">
																	<md-icon>exposure_plus_1</md-icon>
																</button>
															</div> -->
																</div>

															</td>

														</tr>
													</tbody>
												</table>
											</div>
										</p-accordionTab>
									<!-- </div> -->
								</div>

							</div>




						</div>

					</div>
				</p-accordionTab>
			</p-accordion>
		</ng-template>

	</div>
</form>
<!-- rules Block end -->